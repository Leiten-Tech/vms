import{a as z,r as y,u as K,b as I,p as Y,c_ as N,c as Z,a9 as ee,t as te,cx as w,j as e,n as f,B as C,A as re,d as se,cw as ae,c$ as ie,d0 as oe,I as le}from"./index-25a41ef1.js";import{c as ne}from"./VisitorManagement-638cb0f9.js";import{D as de,C as m}from"./column.esm-11a46c7b.js";import{e as D}from"./ExportService-4b3a6c99.js";import{Q as ce}from"./QRScanner-5ba74efd.js";import"./index.esm-21a4a4d3.js";import"./index.esm-9a713e1a.js";import"./jspdf.es.min-40ee8370.js";const Ke=()=>{z();const i=y.useRef(null),M=y.useRef(),p=K(),[T,P]=y.useState([]),[F,O]=y.useState([]),[W,k]=y.useState([]),[v,g]=y.useState([]),[R,B]=y.useState(""),[h,V]=y.useState(""),[A,ye]=y.useState(!1);y.useState();const{isCreate:ue,isView:me,SearchData:pe,loading:q,error:he,tranStatus:ge,DtoEmployeeList:Ee,DtoDepartmentList:Ve,DtoStatusList:fe,DtoTitleList:Ce,DtoIsPreBookingList:Se,DtoVisitorTypeList:xe,DtoProofList:ke,DtoVisitorEntryTypeList:ve,DtoVisitorEntryHeader:Le,DtoVisitorEntryDetail:je,DtoVisitorEntryBelongingDetail:be,DtoVisitorEntryMaterialDetail:Ie,DtoVisitorEntryList:Ne,DtoVisitorEntryCodeList:we,DtoVisitorEmployeeList:De,DtoVisitorNameList:Me,DtoVisitorWorkerList:Te,DtoPreBookingList:Pe,DtoPartyTypeList:Fe,DtoAreaList:Oe,DtoRouteList:We,DtoPartyNameList:Re,DtoDriverList:Be,DtoVehicleList:Ae,DtoMaterialList:qe,DtoVisitorEntryLogList:Je}=I(t=>t.visitorentry),{CheckInOutList:L}=I(t=>t.checkincheckout);y.useEffect(()=>{S()},[]),y.useEffect(()=>{k(L)},[L]),y.useEffect(()=>{Y()},[]);const S=()=>{var t=p(N({PlantId:localStorage.PlantId}));t.then(o=>{var r;o.payload.tranStatus.result?(O(o.payload.VisitorEntryTypeList),k(o.payload.VisitorEntryLogList)):(r=i.current)==null||r.show({severity:"error",summary:"Error Message",detail:o.payload.tranStatus.lstErrorItem[0].Message})}).catch(o=>{var r;(r=i.current)==null||r.show({severity:"error",summary:"Error Message",detail:JSON.stringify(o)})})},c=Z({initialValues:{visType:null,VisitorEntryCode:"",WorkerId:null},validationSchema:ne,onSubmit:(t,{resetForm:o})=>{var r,s,a;if(typeof t.VisitorEntryCode=="string"){(r=i.current)==null||r.show({severity:"warn",summary:"Warning Message",detail:"Please Select Visitor Entry Type & Visitor Entry Code."});return}if(!t.visType&&!t.VisitorEntryCode){(s=i.current)==null||s.show({severity:"warn",summary:"Warning Message",detail:"Please Select Visitor Entry Type & Visitor Entry Code."});return}if(v.length>0&&!t.WorkerId){(a=i.current)==null||a.show({severity:"warn",summary:"Warning Message",detail:"Please Select Worker Id."});return}if(t.visType==60){let n={UserId:localStorage.UserId,VisitorEntryCode:t.VisitorEntryCode.VisitorEntryCode,VisitorEntryDetailId:t.WorkerId,Checkintime:new Date,type:""};p(ae(n)).then(l=>{var d,E;l.payload.tranStatus.result?((d=i.current)==null||d.show({severity:"success",summary:"Success Message",detail:l.payload.tranStatus.lstErrorItem[0].Message}),x()):(E=i.current)==null||E.show({severity:"error",summary:"Error Message",detail:l.payload.tranStatus.lstErrorItem[0].Message})}).catch(l=>{var d;(d=i.current)==null||d.show({severity:"error",summary:"Error Message",detail:JSON.stringify(l)})})}else{let n={UserId:localStorage.UserId,VisitorEntryCode:t.VisitorEntryCode.VisitorEntryCode,VisitorEntryDetailId:t.WorkerId,Checkouttime:new Date,type:""};p(w(n)).then(l=>{var d,E;l.payload.tranStatus.result?((d=i.current)==null||d.show({severity:"success",summary:"Success Message",detail:l.payload.tranStatus.lstErrorItem[0].Message}),x()):(E=i.current)==null||E.show({severity:"error",summary:"Error Message",detail:l.payload.tranStatus.lstErrorItem[0].Message})}).catch(l=>{var d;(d=i.current)==null||d.show({severity:"error",summary:"Error Message",detail:JSON.stringify(l)})})}}}),x=()=>{c.resetForm(),g([]),S()},J=(t,o,r)=>{c.setFieldValue(t,r)},U=(t,o,r)=>{c.setFieldValue(t,r),c.setFieldValue("VisitorEntryCode",""),c.setFieldValue("WorkerId",null),g([])},G=(t,o,r)=>{var a;if(c.setFieldValue(t,r),c.setFieldValue("WorkerId",null),g([]),typeof r!="string"){let n=c.values.visType;if(!n){(a=i.current)==null||a.show({severity:"warn",summary:"Warning Message",detail:"Please Select Visitor Entry Type."});return}let u={VisitorEntryCode:r.VisitorEntryCode,EntryType:n};var s=p(ie(u));s.then(l=>{var d;l.payload.tranStatus.result?l.payload.VisitorEmployeeList&&l.payload.VisitorEmployeeList.length&&l.payload.VisitorEmployeeList.length>0?g(l.payload.VisitorEmployeeList):g([]):(d=i.current)==null||d.show({severity:"error",summary:"Error Message",detail:l.payload.tranStatus.lstErrorItem[0].Message})}).catch(l=>{var d;(d=i.current)==null||d.show({severity:"error",summary:"Error Message",detail:JSON.stringify(l)})})}},H=t=>{var a;c.setFieldValue("VisitorEntryCode",t.query);let o=c.values.visType;if(!o){(a=i.current)==null||a.show({severity:"warn",summary:"Warning Message",detail:"Please Select Visitor Entry Type."});return}let r={text:t.query,EntryType:o,PlantId:+localStorage.PlantId};var s=p(oe(r));s.then(n=>{var u;n.payload.tranStatus.result?P(n.payload.VisitorEntryCheckInCodeList):(u=i.current)==null||u.show({severity:"error",summary:"Error Message",detail:n.payload.tranStatus.lstErrorItem[0].Message})}).catch(n=>{var u;(u=i.current)==null||u.show({severity:"error",summary:"Error Message",detail:JSON.stringify(n)})})},[j,Q]=y.useState({global:{value:null,matchMode:ee.CONTAINS}}),b=t=>{p(N({})).then(r=>{_(r.payload.VisitorEntryLogList).then(s=>{t==="pdf"?D.Export("CheckIn-CheckOut",s,"pdf"):t==="excel"&&D.Export("CheckIn-CheckOut",s,"excel")}).catch(s=>{console.error(s.message)})})},_=t=>new Promise((o,r)=>{let s=[];t.length>0?(t.forEach(a=>{let n={"Visitor Entry Code":a.VisitorEntryCode,"Visitor Type":a.VisitorTypeName,"Visitor Name":a.VisitorName,"Person to Visit":a.PersonToVisit,"Checked In":a.CheckedIn,"Checked Out":a.CheckedOut,"Created By":a.CreatedByName,"Modified By":a.ModifiedByName};s.push(n)}),o(s)):r(new Error("No data available for export."))}),X=()=>{const t=o=>{const r=o.target.value;let s={...j};s.global.value=r,Q(s),B(r)};return e.jsxs("div",{className:"flex justify-content-between",children:[e.jsxs("span",{className:"p-input-icon-left",children:[e.jsx("i",{className:"pi pi-search"}),e.jsx(le,{value:R,onChange:t,placeholder:"Search"})]}),e.jsx("div",{className:"flex align-items-center justify-content-end gap-2",children:e.jsxs("div",{className:"action-btn",children:[e.jsx(C,{type:"button",icon:"pi pi-file-excel",severity:"success",onClick:()=>b("excel"),"data-pr-tooltip":"XLS"}),e.jsx(C,{type:"button",icon:"pi pi-file-pdf",severity:"warning",onClick:()=>b("pdf"),"data-pr-tooltip":"PDF"})]})})]})};y.useEffect(()=>{h&&h!=""&&(c.setFieldValue("VisitorEntryCode",h.split(":")[0]),$(h.split(":")))},[h]);const $=t=>{let o={UserId:localStorage.UserId,VisitorEntryCode:t[0],VisitorEntryDetailId:t[1],Checkouttime:te(new Date),type:""};p(w(o)).then(s=>{var a,n;s.payload.tranStatus.result?(S(),(a=i.current)==null||a.show({severity:"success",summary:"Success Message",detail:s.payload.tranStatus.lstErrorItem[0].Message}),V("")):((n=i.current)==null||n.show({severity:"error",summary:"Error Message",detail:s.payload.tranStatus.lstErrorItem[0].Message}),V(""))}).catch(s=>{var a;(a=i.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(s)}),V("")})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsx("div",{className:"grid grid-nogutter",children:e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Check In / Check Out"})})})}),q?e.jsx(re,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-container scroll-y",children:[e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:A?e.jsxs(e.Fragment,{children:[e.jsx(ce,{scanned:h,setScannedText:V}),e.jsx(f,{type:"text",name:"VisitorEntryCode",label:"Visitor Entry Code ",options:"",show:!0,required:!1,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-2",formik:c})]}):e.jsxs("div",{className:"grid mt-1",children:[e.jsx(f,{type:"select",name:"visType",label:"Visitor Entry Type ",options:F,show:!0,required:!1,disable:!1,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:U,fldStyle:"col-12 md:col-3",formik:c}),e.jsx(f,{type:"autocomplete",name:"VisitorEntryCode",label:"Visitor Entry Code ",show:!0,required:!0,disable:!1,optionLabel:"",optionValue:"",handleChange:t=>G("VisitorEntryCode",{},t.value),fldStyle:"col-12 md:col-3",formik:c,autoSearch:H,autoCompleteRef:M,autoSuggestions:T,autoCompleteLbl:"VisitorEntryCode",field:"VisitorEntryCode",maxLength:20}),e.jsx(f,{type:"select",name:"WorkerId",label:"Visitors / Worker Name",options:v,show:!0,required:!1,disable:!1,optionLabel:"VisitorEmpName",optionValue:"VisitorEntryDetailId",handleSelect:J,fldStyle:"col-12 md:col-3",formik:c}),e.jsxs("div",{className:"col-12 md:col-3",children:[e.jsx("label",{className:"form-label mt-4",children:" "}),e.jsx(C,{label:"Check In / Check Out",title:"Add",icon:"las la-save",className:"mr-2 p-1",onClick:c.handleSubmit}),e.jsx(C,{label:"Clear",severity:"danger",title:"Clear",icon:"las la-times",className:"mr-2 p-1",onClick:x})]})]})})})}),e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsx("div",{className:"card",children:e.jsxs(de,{value:W,showGridlines:!0,paginator:!0,filters:j,filterDisplay:"menu",globalFilterFields:["VisitorEntryCode","VisitorTypeName","VisitorName","PersonToVisit","CheckedIn","CreatedByName","CheckedOut","ModifiedByName"],emptyMessage:"No Data found.",editMode:"cell",rows:25,rowsPerPageOptions:[25,50,100,500,1e3],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Entries",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",tableStyle:{minWidth:"50rem"},header:X,children:[e.jsx(m,{field:"VisitorEntryCode",header:"Visitor Entry Code",sortable:!0}),e.jsx(m,{field:"VisitorTypeName",header:"Visitor Type",sortable:!0}),e.jsx(m,{field:"VisitorName",header:"Visitor Name",sortable:!0}),e.jsx(m,{field:"PersonToVisit",header:"Person to Visit",sortable:!0}),e.jsx(m,{field:"CheckedIn",header:"Checked In",sortable:!0}),e.jsx(m,{field:"CreatedByName",header:"Checked In By",sortable:!0}),e.jsx(m,{field:"CheckedOut",header:"Checked Out",sortable:!0}),e.jsx(m,{field:"ModifiedByName",header:"Checked Out By",sortable:!0})]})})})})})]})})]})}),e.jsx(se,{toast:i})]})};export{Ke as default};
