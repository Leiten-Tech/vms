import{a as tt,r as u,u as at,L as De,a9 as it,p as lt,b as st,aS as rt,c as Te,aU as ot,aV as nt,j as t,B as E,A as dt,d as ct,F as ke,n as h,I as mt,aW as ut,aX as pt}from"./index-25a41ef1.js";import{V as Oe,g as yt}from"./Master-b11b8a2f.js";import{F as Ne}from"./fileupload.esm-b904f07b.js";import{D as ht,C as j}from"./column.esm-11a46c7b.js";import"./index.esm-21a4a4d3.js";import"./index.esm-9a713e1a.js";const ft=(S,s,L,P,C,W)=>{const f=()=>{var n;if(!C&&!P){let I=s.find(F=>F==S);if(I.Status==2){(n=W.current)==null||n.show({severity:"warn",summary:"Warning Message",detail:"Visitor Already Inactivated."});return}I.Status=2,I.StatusName="Inactive";let U=s.filter(F=>F!=S);U.push(I),L(U)}};return t.jsx(E,{label:"",severity:"danger",title:"Delete",icon:"las la-times",className:"mr-2 p-1",disabled:!!P,onClick:()=>f()})},Dt=S=>t.jsx("a",{style:{color:"blue"},href:S.DocumentUrl,target:"_blank",children:S.DocumentName}),Nt=S=>t.jsx("a",{href:S.VisitorDocumentUrl,target:"_blank",children:S.VisitorDocumentName}),bt=S=>{const{isView:s,isCreate:L,VisitorTypeList:P,handleSelect:C,handleOnChange:W,TitleList:f,formik:n,CountryList:I,Onchangecountry:U,StateList:F,Onchangestate:x,CityList:R,IdCardList:ne,StatusList:p,onUpload:A,itemTemplate:T,imageUrl:B,values:z,visitorForm:M,visitorRef:k,onSubmit:q,onChangeVisitorType:ee,tempStateList:te,tempCityList:O,handleCloseImage:K,handleChange:J,profUploadRef:$,VisitorhandleHyperlink:g,onUploadDocumentVisitor:de,deleteDocumentsVisitor:w,documentVisitorUploadRef:_,documentUrlVisitor:Y}=S,ae={icon:"las la-camera-retro",iconOnly:!0},ie={icon:"las la-upload",iconOnly:!0};return t.jsx(ke,{initialValues:M,validationSchema:Oe,onSubmit:q,ref:k,children:t.jsx("div",{className:"white",children:t.jsx("div",{className:"widget-body",children:t.jsx("div",{className:"normal-table",children:t.jsxs("div",{className:"grid",children:[t.jsx("div",{className:"col-12 md:col-3",children:t.jsx("div",{className:"grid",children:t.jsx("div",{className:"col-12 text-center",children:t.jsxs("div",{className:"img-preview-container m-auto",children:[t.jsx(Ne,{mode:"basic",name:"demo[]",chooseOptions:ae,className:"custom-upload inline-block",accept:"image/jpeg, image/png, image/jpg",auto:!0,chooseLabel:"Upload Photo",uploadHandler:A,customUpload:!0,disabled:s,ref:$}),t.jsx("div",{className:"img-preview-hidden",children:t.jsx("img",{src:B,alt:"logo",className:"w-full"})}),t.jsx("a",{className:`${s?"p-disabled":null} img-preview-close`,onClick:K,children:t.jsx("i",{className:"las la-times-circle"})})]})})})}),t.jsx("div",{className:"col-12 md:col-9",children:t.jsxs("div",{className:"grid",children:[t.jsx(h,{type:"text",name:"VisitorCode",label:"Visitor Code ",options:"",show:!1,required:!0,disable:!!(s||L==!1),optionLabel:"",optionValue:"",handleSelect:"",onKeyPress:()=>{},fldStyle:"col-12 md:col-4",formik:n}),t.jsx(h,{type:"select",name:"VisitorTypeId",label:"Visitor Type ",options:P,show:!0,required:!0,disable:!!(s||L==!1),optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:ee,fldStyle:"col-12 md:col-4",formik:n}),t.jsx(h,{type:"text_title",name:"TitleId",label:"First Name ",options:f,show:!0,required:!0,disable:!!s,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:C,handleOnChange:W,titleInputName:"FirstName",fldStyle:"col-12 md:col-4",formik:n,maxlength:50}),t.jsx(h,{type:"text",name:"LastName",label:"Last Name ",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-4",formik:n,maxlength:50})]})}),t.jsx("div",{className:"col-12 md:col-9",children:t.jsxs("div",{className:"grid",children:[t.jsx(h,{type:"text",name:"VisitorCompany",label:"Visitor Company ",options:"",show:!0,required:!1,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-4",formik:n,maxlength:100}),t.jsx(h,{type:"text",name:"MailId",label:"Mail ID ",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-4",formik:n}),t.jsx(h,{type:"text",name:"MobileNo",label:"Mobile No ",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-4",formik:n,keyfilter:"int",maxLength:15,minLength:9})]})}),t.jsx(h,{type:"textarea",name:"Address",label:"Address",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",formik:n,fldStyle:"col-12 md:col-3",maxlength:"500",style:{maxHeight:"100px",overflowY:"auto"}}),t.jsx(h,{type:"select",name:"Status",label:"Status ",options:p,show:!0,required:!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:C,fldStyle:"col-12 md:col-3",formik:n,disable:!!s||L==null||L==!0}),t.jsxs("div",{className:"col-12 md:col-3",children:[t.jsxs("label",{className:"form-label",children:["Document Upload ",t.jsx("span",{className:"hlt-txt",children:"*"})]}),t.jsxs("div",{className:"p-inputgroup",children:[t.jsx("div",{className:"browse-links",children:t.jsx(E,{label:n.values.VisitorDocumentName,link:!0,onClick:g})}),t.jsx(Ne,{mode:"basic",chooseOptions:ie,uploadHandler:de,chooseLabel:Nt,auto:!0,customUpload:!0,ref:_,disabled:s}),t.jsx(E,{icon:"las la-times",onClick:w,disabled:s})]})]})]})})})})})},St=S=>{const{setVisitorDetailList:s,visitorDetailList:L,filters:P,TableHeader:C,TitleList:W,handleSelect:f,isView:n,DepartmentList:I,IdCardList:U,StatusList:F,OnClear:x,visitorDetailForm:R,visitorDetailRef:ne,formik:p,OnDelete:A,documentUrl:T,onUploadDocument:B,disableForm:z,isCreate:M,onRowSelect:k,toast:q,deleteDocuments:ee,handleHyperlink:te,handleDChange:O,documentUploadRef:K,WorkSeverityList:J}=S,$={icon:"las la-upload",iconOnly:!0};return t.jsx(ke,{initialValues:p.visitorDetailForm,validationSchema:p.VisitorDetailValidationSchema,onSubmit:p.handleSubmit,children:t.jsx("div",{className:z?"p-hidden":null,children:t.jsx("div",{className:"white",children:t.jsx("div",{className:"widget-body",children:t.jsxs("div",{className:"normal-table",children:[t.jsx("div",{className:"page-title",children:t.jsx("div",{className:"grid grid-nogutter",children:t.jsx("div",{className:"md:col-6",children:t.jsx("h1",{children:"Worker Details"})})})}),t.jsxs("div",{className:"grid",children:[t.jsx(h,{type:"text_title",name:"TitleId",label:"First Name ",options:W,show:!0,required:!0,disable:!!n,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:f,titleInputName:"FirstName",fldStyle:"col-12 md:col-3",formik:p,maxlength:50}),t.jsx(h,{type:"text",name:"LastName",label:"Last Name ",options:"",show:!0,required:!0,disable:!!n,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-3",formik:p,maxlength:50}),t.jsx(h,{type:"select",name:"DepartmentId",label:"Department ",options:I,show:!0,required:!0,disable:!!n,optionLabel:"DepartmentName",optionValue:"DepartmentId",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p}),t.jsx(h,{type:"Calendar",name:"Dob",label:"Date of Birth",options:"",show:!0,required:!0,disable:!!n,optionLabel:"",optionValue:"",handleChange:O,fldStyle:"col-12 md:col-3",formik:p,maxDate:new Date}),t.jsx(h,{type:"text",name:"MailId",label:"Mail ID ",options:"",show:!0,required:!1,disable:!!n,optionLabel:"",optionValue:"",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p}),t.jsx(h,{type:"text",name:"MobileNo",label:"Mobile No ",options:"",show:!0,required:!0,disable:!!n,optionLabel:"",optionValue:"",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p,keyfilter:"int",maxLength:15,minLength:9}),t.jsx(h,{type:"select",name:"IdCardType",label:"ID Card Type ",options:U,show:!0,required:!0,disable:!!n,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p}),t.jsx(h,{type:"text",name:"IdCardNo",label:"ID Card No ",options:"",show:!0,required:!0,disable:!!n,optionLabel:"",optionValue:"",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p}),t.jsx(h,{type:"select",name:"WorkSeverity",label:"Work Severity ",options:J,show:!0,required:!0,disable:!!n,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p}),t.jsxs("div",{className:"col-12 md:col-3",children:[t.jsxs("label",{className:"form-label",children:["Document Upload ",t.jsx("span",{className:"hlt-txt",children:"*"})]}),t.jsxs("div",{className:"p-inputgroup",children:[t.jsx("div",{className:"browse-links",children:t.jsx(E,{label:p.values.DocumentName,link:!0,onClick:te,disabled:!!n})}),t.jsx(Ne,{mode:"basic",chooseOptions:$,uploadHandler:B,chooseLabel:T,auto:!0,customUpload:!0,ref:K,disabled:!!n}),t.jsx(E,{icon:"las la-times",onClick:ee,disabled:!!n})]})]}),t.jsx(h,{type:"Calendar",name:"ExpirryDate",label:"Expiry Date",options:"",show:!0,required:!0,disable:!!n,optionLabel:"",optionValue:"",handleChange:O,fldStyle:"col-12 md:col-3",formik:p,minDate:new Date}),t.jsx(h,{type:"select",name:"Status",label:"Worker Status ",options:F,show:!0,required:!0,disable:!!n,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:f,fldStyle:"col-12 md:col-3",formik:p})]}),t.jsxs("div",{className:"text-center mb-2",children:[t.jsx(E,{label:"Add",severity:"success",icon:"las la-plus",title:"Add",className:"text-center",type:"submit",onClick:p.handleSubmit,disabled:!!n}),t.jsx(E,{label:"Clear",severity:"danger",icon:"las la-trash",title:"Clear",className:"text-center",onClick:()=>x(),disabled:!!n})]}),t.jsx("div",{className:"card",children:t.jsxs(ht,{value:L,showGridlines:!0,paginator:!0,filters:P,filterDisplay:"menu",globalFilterFields:["VisitorName","DepartMentName","Dob","MobileNo","MailId","IdCardTypeName","IdCardNo","StatusName"],header:C,emptyMessage:"No Data found.",rows:5,rowsPerPageOptions:[5,10,25,50],tableStyle:{minWidth:"50rem"},onRowDoubleClick:g=>k(g),children:[t.jsx(j,{hidden:!M||!n,header:"Action",style:{textAlign:"center"},body:g=>ft(g,L,s,n,M,q)}),t.jsx(j,{field:"VisitorName",header:"Worker Name"}),t.jsx(j,{field:"DepartMentName",header:"Department Name"}),t.jsx(j,{field:"ShowDate",header:"Date Of Birth"}),t.jsx(j,{field:"MobileNo",header:"Mobile No"}),t.jsx(j,{field:"MailId",header:"Mail ID"}),t.jsx(j,{field:"IdCardTypeName",header:"ID Card Type"}),t.jsx(j,{field:"IdCardNo",header:"ID Card No"}),t.jsx(j,{field:"WorkSeverityName",header:"Work Severity"}),t.jsx(j,{header:"Document",body:g=>Dt(g)}),t.jsx(j,{field:"ShowExpirryDate",header:"Expiry Date"}),t.jsx(j,{field:"StatusName",header:"Status"})]})})]})})})})})},vt=()=>{const S=tt(),s=u.useRef(null),L=u.useRef(),P=u.useRef(),C=at(),[W,f]=u.useState(De.NO_IMG),[n,I]=u.useState(""),[U,F]=u.useState(""),[x,R]=u.useState([]),[ne,p]=u.useState(null),[A,T]=u.useState(null),[B,z]=u.useState(null),[M,k]=u.useState([]),[q,ee]=u.useState([]),[te,O]=u.useState(!0),[K,J]=u.useState([]),[$,g]=u.useState([]),[de,w]=u.useState(!1),_=u.useRef(),Y=u.useRef(),ae=u.useRef(),[ie,be]=u.useState(-1),[Se,Pe]=u.useState({global:{value:null,matchMode:it.CONTAINS}}),[We,Re]=u.useState("");u.useEffect(()=>{lt()});const{isCreate:v,isView:Q,createEditData:It,loading:Ge,error:xt,tranStatus:gt,VisitorHeader:i,VisitorTypeList:Ae,TitleList:le,IdCardList:se,StatusList:re,CountryList:Ie,StateList:ce,CityList:me,DepartmentList:ue,VisitorDetail:xe,VisitorSearchList:Vt,WorkSeverityList:pe}=st(e=>e.visitor),qe=()=>{const e=c=>{const a=c.target.value;let l={...Se};l.global.value=a,Pe(l),Re(a)};return t.jsx("div",{className:"flex justify-content-between",children:t.jsxs("span",{className:"p-input-icon-left",children:[t.jsx("i",{className:"pi pi-search"}),t.jsx(mt,{value:We,onChange:e,placeholder:"Keyword Search"})]})})};u.useEffect(()=>{if(v==!1||Q==!0){v||(i.VisitorTypeId==35?O(!0):O(!1));let c=[];for(let a=0;a<xe.length;a++){const l=xe[a];let o={};o.VisitorDetailId=l.VisitorDetailId,o.VisitorId=l.VisitorId,o.TitleId=l.TitleId,o.FirstName=l.FirstName,o.LastName=l.LastName,o.DepartmentId=l.DepartmentId,o.Dob=new Date(l.Dob),o.MailId=l.MailId,o.MobileNo=l.MobileNo,o.IdCardType=l.IdCardType,o.IdCardNo=l.IdCardNo,o.DocumentName=l.DocumentName,o.DocumentUrl=l.DocumentUrl,o.Status=l.Status,o.ExpirryDate=l.ExpirryDate,o.WorkSeverity=l.WorkSeverity,o.VisitorName=le.find(N=>N.MetaSubId==o.TitleId).MetaSubDescription+". "+l.FirstName+" "+l.LastName,o.DepartMentName=l.DepartmentId?ue.find(N=>N.DepartmentId==l.DepartmentId).DepartmentName:null,o.IdCardTypeName=se.find(N=>N.MetaSubId==l.IdCardType).MetaSubDescription,o.StatusName=re.find(N=>N.MetaSubId==l.Status).MetaSubDescription,o.WorkSeverityName=pe.find(N=>N.MetaSubId==l.WorkSeverity).MetaSubDescription;const d=new Date(l.Dob).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});o.ShowDate=d;const D=new Date(l.ExpirryDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});o.ShowExpirryDate=D,c.push(o),ge(o.DocumentUrl).then(N=>{const X=new File([N],o.DocumentName,{type:"image/*",lastModified:1695716506050});k([...M,X])}).catch(N=>{console.error("Error fetching image:",N)})}R(c),F(i.VisitorDocumentUrl),ge(i.DocumentUrl).then(a=>{const l=new File([a],i.DocumentName,{type:"image/*",lastModified:1695716506050});p(l),f(i.DocumentUrl)}).catch(a=>{console.error("Error fetching image:",a)})}else{var e=C(rt({VisitorId:0}));e.then(a=>{var l;a.payload.tranStatus.result?a.payload.CountryList&&a.payload.CountryList.length&&a.payload.CountryList.length>0&&he("CountryId",{},a.payload.CountryList[0].CountryId):(l=s.current)==null||l.show({severity:"error",summary:"Error",detail:a.payload.tranStatus.lstErrorItem.message})}).catch(a=>{var l;(l=s.current)==null||l.show({severity:"error",summary:"Error",detail:JSON.stringify(a)})})}},[]),u.useEffect(()=>{g(me),J(ce)},[me,ce]);async function ge(e){const c=await fetch(e);if(!c.ok)throw new Error(`Failed to fetch image: ${c.statusText}`);return await c.blob()}const Ve={VisitorId:i!=null?i.VisitorId:0,VisitorCode:i!=null?i.VisitorCode:"",VisitorTypeId:i!=null?i.VisitorTypeId:35,CompanyId:i!=null?i.CompanyId:localStorage.CompanyId,PlantId:i!=null?i.PlantId:localStorage.PlantId,CountryId:i!=null?i.CountryId:null,StateId:i!=null?i.StateId:null,CityId:i!=null?i.CityId:null,TitleId:i!=null?i.TitleId:37,FirstName:i!=null?i.FirstName:"",LastName:i!=null?i.LastName:"",Dob:i!=null?new Date(i.Dob):new Date,VisitorCompany:i!=null?i.VisitorCompany:"",Address:i!=null?i.Address:"",MailId:i!=null?i.MailId:"",MobileNo:i!=null?i.MobileNo:"",IdCardType:i!=null?i.IdCardType:17,IdCardNo:i!=null?i.IdCardNo:"",DocumentName:i!=null?i.DocumentName:"",DocumentUrl:i!=null?i.DocumentUrl:"",VisitorDocumentName:i!=null?i.VisitorDocumentName:"",VisitorDocumentUrl:i!=null?i.VisitorDocumentUrl:"",Status:i!=null?i.Status:1,CreatedBy:i!=null?i.CreatedBy:+localStorage.UserId,CreatedOn:i!=null?new Date(i.CreatedOn):new Date,ModifiedBy:i!=null?+localStorage.UserId:null,ModifiedOn:i!=null?new Date:null},Ce={VisitorDetailId:0,VisitorId:0,TitleId:37,FirstName:"",LastName:"",DepartmentId:null,Dob:new Date,MailId:"",MobileNo:"",IdCardType:17,IdCardNo:"",DocumentName:"",DocumentUrl:"",Status:1,ExpirryDate:new Date,WorkSeverity:96},Z=e=>e.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),y=Te({initialValues:Ve,validationSchema:Oe,onSubmit:(e,{resetForm:c})=>{var fe,H,oe;w(!0);const a=new FormData;let l=[];if(e.Dob=Z(new Date(e.Dob)),e.CreatedOn=Z(new Date(e.CreatedOn)),v||(e.ModifiedOn=Z(new Date(e.ModifiedOn))),v&&!B){w(!1),(fe=s.current)==null||fe.show({severity:"warn",summary:"Warning Message",detail:"Please Add Document."});return}if(e.VisitorTypeId==35&&v==!0){let r={};r.VisitorDetailId=0,r.VisitorId=0,r.TitleId=e.TitleId,r.FirstName=e.FirstName,r.LastName=e.LastName,r.DepartmentId=null,r.Dob=e.Dob,r.MailId=e.MailId,r.MobileNo=e.MobileNo,r.IdCardType=e.IdCardType,r.IdCardNo=e.IdCardNo,r.DocumentName="",r.DocumentUrl="",r.Status=e.Status,r.ExpirryDate=new Date,r.WorkSeverity=96,l.push(r)}else e.VisitorTypeId==35&&v==!1?(x.forEach(r=>{r.TitleId=e.TitleId,r.FirstName=e.FirstName,r.LastName=e.LastName,r.Dob=e.Dob,r.MailId=e.MailId,r.MobileNo=e.MobileNo,r.IdCardType=e.IdCardType,r.IdCardNo=e.IdCardNo}),l=x):(x.forEach(r=>{delete r.VisitorName,delete r.DepartMentName,delete r.IdCardTypeName,delete r.StatusName,delete r.ShowExpirryDate,delete r.WorkSeverityName,r.Dob=Z(new Date(r.Dob)),r.ExpirryDate=Z(new Date(r.ExpirryDate))}),l=x);if(l.length==0){w(!1),(H=s.current)==null||H.show({severity:"warn",summary:"Warning Message",detail:"Please Add Atleast One Worker Detail."});return}a.append("webfile",ne),a.append("webfile1",B);for(var o in M){var d=l.findIndex(r=>r.DocumentName==M[o].name);d!=-1&&a.append("webfiles",M[o])}for(var D in q){var d=l.findIndex(V=>V.DocumentName==q[o].name);d!=-1&&a.append("webfile1",q[o])}let X=JSON.stringify({Visitor:e,VisitorDetail:l});if(a.append("input",X),v==!1){if(!i.VisitorDocumentName||i.VisitorDocumentName==""){(oe=s.current)==null||oe.show({severity:"warn",summary:"Warning Message",detail:"Please Add Document."});return}var b=C(ut(a));b.then(r=>{var V,G;r.payload.tranStatus.result==!0?((V=s.current)==null||V.show({severity:"success",summary:"Success Message",detail:r.payload.tranStatus.lstErrorItem[0].Message}),setTimeout(()=>{S.push("/home/vVisitor")},800)):(w(!1),(G=s.current)==null||G.show({severity:"error",summary:"Error Message",detail:r.payload.tranStatus.lstErrorItem[0].Message}))}).catch(r=>{var V;w(!1),(V=s.current)==null||V.show({severity:"error",summary:"Error",detail:JSON.stringify(r)})})}else{var b=C(pt(a));b.then(V=>{var G,Ue;V.payload.tranStatus.result==!0?(w(!1),(G=s.current)==null||G.show({severity:"success",summary:"Success Message",detail:V.payload.tranStatus.lstErrorItem[0].Message}),Me()):(w(!1),(Ue=s.current)==null||Ue.show({severity:"error",summary:"Error",detail:V.payload.tranStatus.lstErrorItem[0].Message}))}).catch(V=>{var G;w(!1),(G=s.current)==null||G.show({severity:"error",summary:"Error",detail:V})})}}}),m=Te({initialValues:Ce,validationSchema:yt,onSubmit:(e,{resetForm:c})=>{var d,D,N,X;if(!A){(d=s.current)==null||d.show({severity:"warn",summary:"Warning Message",detail:"Please Add Document."});return}let a={};a.VisitorDetailId=e.VisitorDetailId,a.VisitorId=e.VisitorId,a.TitleId=e.TitleId,a.FirstName=e.FirstName.trim(),a.LastName=e.LastName.trim(),a.DepartmentId=e.DepartmentId,a.Dob=e.Dob,a.MailId=e.MailId,a.MobileNo=e.MobileNo,a.IdCardType=e.IdCardType,a.IdCardNo=e.IdCardNo,a.DocumentName=e.DocumentName||"",a.DocumentUrl=e.DocumentUrl||"",a.Status=e.Status,a.ExpirryDate=e.ExpirryDate,a.WorkSeverity=e.WorkSeverity,a.VisitorName=le.find(b=>b.MetaSubId==e.TitleId).MetaSubDescription+". "+a.FirstName+" "+a.LastName,a.DepartMentName=ue.find(b=>b.DepartmentId==e.DepartmentId).DepartmentName,a.IdCardTypeName=se.find(b=>b.MetaSubId==e.IdCardType).MetaSubDescription,a.StatusName=re.find(b=>b.MetaSubId==e.Status).MetaSubDescription,a.WorkSeverityName=pe.find(b=>b.MetaSubId==e.WorkSeverity).MetaSubDescription;const l=e.Dob.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});a.ShowDate=l;const o=e.ExpirryDate.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"});if(a.ShowExpirryDate=o,ie==-1){if((x.filter(H=>H.VisitorName==a.VisitorName)||[]).length>0&&a.VisitorDetailId==0){(D=s.current)==null||D.show({severity:"warn",summary:"Warning Message",detail:"Worker Already Exists"});return}if((x.filter(H=>H.MobileNo==a.MobileNo)||[]).length>0&&a.VisitorDetailId==0){(N=s.current)==null||N.show({severity:"warn",summary:"Warning Message",detail:"Mobile No Already Exists"});return}if(a.MailId!=""&&(x.filter(oe=>oe.MailId==a.MailId)||[]).length>0&&a.VisitorDetailId==0){(X=s.current)==null||X.show({severity:"warn",summary:"Warning Message",detail:"Mail ID Already Exists"});return}R([...x,a])}else{let b=x;b[ie]=a,R(b),be(-1)}A&&(M.length>0?k([...M,A]):k([A])),ye()}}),Me=()=>{y.resetForm(),m.resetForm(),k([]),T(null),p(null),O(!0),R([]),f(De.NO_IMG),I(""),J([]),g([]),he("CountryId",{},Ie[0].CountryId)},Je=e=>{T(null),m.setFieldValue("",e),m.setFieldValue("VisitorDetailId",e.data.VisitorDetailId),m.setFieldValue("VisitorId",e.data.VisitorId),m.setFieldValue("TitleId",e.data.TitleId),m.setFieldValue("FirstName",e.data.FirstName),m.setFieldValue("LastName",e.data.LastName),m.setFieldValue("DepartmentId",e.data.DepartmentId),m.setFieldValue("Dob",e.data.Dob),m.setFieldValue("MailId",e.data.MailId),m.setFieldValue("MobileNo",e.data.MobileNo),m.setFieldValue("IdCardType",e.data.IdCardType),m.setFieldValue("IdCardNo",e.data.IdCardNo),m.setFieldValue("DocumentName",e.data.DocumentName),m.setFieldValue("DocumentUrl",e.data.DocumentUrl),m.setFieldValue("Status",e.data.Status),m.setFieldValue("ExpirryDate",new Date(e.data.ExpirryDate)),m.setFieldValue("WorkSeverity",e.data.WorkSeverity);let c=M[e.index];I(e.data.DocumentUrl),T(c),be(e.index)},je=(e,c,a)=>{y.setFieldValue(e,a)},He=e=>{y.setFieldValue(e.target.name,e.value)},Be=e=>{m.setFieldValue(e.target.name,e.value)},_e=(e,c,a)=>{m.setFieldValue(e,a)},Xe=(e,c,a)=>{y.setFieldValue(e??y[c][e],y,a)},ye=()=>{m.resetForm(),T(null),I("")},ze=(e,c,a)=>{y.setFieldValue(e,a),a==35?(O(!0),ye(),R([]),k([])):O(!1)},Le=()=>{var e;f(De.NO_IMG),p(null),(e=ae.current)==null||e.clear(),y.setFieldValue("DocumentName",""),y.setFieldValue("DocumentUrl","")},he=(e,c,a)=>{J([]),g([]),y.setFieldValue(e,a),y.setFieldValue("StateId",null);var o=C(ot({CountryId:a}));o.then(d=>{var D;d.payload.tranStatus.result?(J(d.payload.StateList),d.payload.StateList&&d.payload.StateList.length&&d.payload.StateList.length>0&&Fe("StateId",{},d.payload.StateList[0].StateId)):(D=s.current)==null||D.show({severity:"error",summary:"Error",detail:d.payload.tranStatus.lstErrorItem.message})}).catch(d=>{var D;(D=s.current)==null||D.show({severity:"error",summary:"Error",detail:JSON.stringify(d)})})},Fe=(e,c,a)=>{g([]),y.setFieldValue(e,a),y.setFieldValue("CityId",null);var o=C(nt({StateId:a}));o.then(d=>{var D;d.payload.tranStatus.result?(g(d.payload.CityList),d.payload.CityList&&d.payload.CityList.length&&d.payload.CityList.length>0&&je("CityId",{},d.payload.CityList[0].CityId)):(D=s.current)==null||D.show({severity:"error",summary:"Error",detail:d.payload.tranStatus.lstErrorItem.message})}).catch(d=>{var D;(D=s.current)==null||D.show({severity:"error",summary:"Error",detail:JSON.stringify(d)})})},Ke=e=>{var c,a;if(W!=""&&Le(),e.files[0].type!="image/jpeg"&&e.files[0].type!="image/png"&&e.files[0].type!="image/jpg"){(c=s.current)==null||c.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG)"});return}if(e.files.length>0){p(e.files[0]),y.setFieldValue("DocumentName",e.files[0].name),y.setFieldValue("DocumentUrl",e.files[0].name);const l=URL.createObjectURL(e.files[0]);f(l)}else{(a=s.current)==null||a.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG)"});return}},we=(e,c)=>{const a=e.name.slice((e.name.lastIndexOf(".")-1>>>0)+2).toLowerCase(),l=e.type.toLowerCase();return c.includes(a)||c.includes(l)},$e=e=>{var a,l,o;Y.current&&Ee();const c=["jpeg","jpg","png","pdf","doc","docx","xls","xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"];if(e.files&&!we(e.files[0],c)){(a=s.current)==null||a.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"}),(l=Y.current)==null||l.clear();return}if(e.files.length>0){z(e.files[0]),y.setFieldValue("VisitorDocumentName",e.files[0].name);const d=URL.createObjectURL(e.files[0]);y.setFieldValue("VisitorDocumentUrl",e.files[0].name),F(d)}else{(o=s.current)==null||o.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"});return}},Ye=e=>{var a,l,o;_.current&&ve();const c=["jpeg","jpg","png","pdf","doc","docx","xls","xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"];if(e.files&&!we(e.files[0],c)){(a=s.current)==null||a.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"}),(l=_.current)==null||l.clear();return}if(e.files.length>0){T(e.files[0]),m.setFieldValue("DocumentName",e.files[0].name);const d=URL.createObjectURL(e.files[0]);m.setFieldValue("DocumentUrl",e.files[0].name),I(d)}else{(o=s.current)==null||o.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"});return}},ve=()=>{var e;(e=_.current)==null||e.clear(),I(""),T(null),m.setFieldValue("DocumentName",""),m.setFieldValue("DocumentUrl","")},Ee=()=>{var e;(e=Y.current)==null||e.clear(),F(""),z(null),y.setFieldValue("VisitorDocumentName",""),y.setFieldValue("VisitorDocumentUrl","")},Qe=()=>{n!=""&&window.open(n,"_blank")},Ze=()=>{U!=""&&window.open(U,"_blank")},et=()=>t.jsxs("div",{className:"flex align-items-center flex-column",children:[t.jsx("i",{className:"pi pi-image mt-3 p-5",style:{fontSize:"5em",borderRadius:"50%",backgroundColor:"var(--surface-b)",color:"var(--surface-d)"}}),t.jsx("span",{style:{fontSize:"1.2em",color:"var(--text-color-secondary)"},className:"my-5",children:"Drag and Drop Image Here"})]});return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"page-container",children:t.jsxs("div",{className:"inner-page-container",children:[t.jsx("div",{className:"page-title",children:t.jsxs("div",{className:"grid grid-nogutter",children:[t.jsx("div",{className:"md:col-6",children:t.jsx("h1",{children:"Visitor"})}),t.jsx("div",{className:"md:col-6 text-right",children:t.jsxs("div",{className:"action-btn",children:[t.jsxs(t.Fragment,{children:[t.jsx(E,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",type:"submit",onClick:y.handleSubmit,disabled:Q||de}),t.jsx(E,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:!!(Q||v==!1),onClick:()=>Me()})]}),t.jsx(E,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{S.push("/home/vVisitor")}})]})})]})}),Ge?t.jsx(dt,{}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"form-container scroll-y",children:[t.jsx(bt,{isView:Q,isCreate:v,VisitorTypeList:Ae,handleSelect:je,TitleList:le,CountryList:Ie,Onchangecountry:he,StateList:ce,Onchangestate:Fe,CityList:me,IdCardList:se,StatusList:re,onUpload:Ke,itemTemplate:et,imageUrl:W,handleOnChange:Xe,visitorForm:Ve,visitorRef:L,formik:y,onChangeVisitorType:ze,tempStateList:K,tempCityList:$,handleCloseImage:Le,handleChange:He,profUploadRef:ae,VisitorhandleHyperlink:Ze,onUploadDocumentVisitor:$e,deleteDocumentsVisitor:Ee,documentUrlVisitor:U,documentVisitorUploadRef:Y}),t.jsx(St,{visitorDetailList:x,filters:Se,TableHeader:qe,TitleList:le,handleSelect:_e,isView:Q,DepartmentList:ue,IdCardList:se,StatusList:re,OnClear:ye,visitorDetailForm:Ce,visitorDetailRef:P,formik:m,setVisitorDetailList:R,documentUrl:n,onUploadDocument:Ye,disableForm:te,isCreate:v,onRowSelect:Je,toast:s,deleteDocuments:ve,handleHyperlink:Qe,handleDChange:Be,documentUploadRef:_,WorkSeverityList:pe})]})})]})}),t.jsx(ct,{toast:s})]})};export{vt as default};
