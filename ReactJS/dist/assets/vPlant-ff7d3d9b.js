import{j as s,ay as B,B as w,a as k,u as q,r as i,b as F,az as V,p as z,aA as Q,aB as v,C as U,d as D,aC as _,g as L,aD as $,aE as J}from"./index-25a41ef1.js";import{P as K,A as G}from"./PageHeader-b76b68bd.js";import{p as X}from"./PermissionService-9ad252b6.js";import{e as N}from"./ExportService-4b3a6c99.js";import{S as Y}from"./sidebar.esm-f3fc22cd.js";import"./column.esm-11a46c7b.js";import"./index.esm-9a713e1a.js";import"./inputswitch.esm-a89edc74.js";import"./jspdf.es.min-40ee8370.js";const Z=h=>{const{visible:d,handleClosePop:t,qrValue:g,qrTxt:c,handlePrint:n,componentRef:u}=h;return s.jsx(Y,{visible:d,onHide:()=>t(),className:"no-print",style:{width:"50vw",minWidth:"50vw",maxWidth:"50vw",height:"90vh",minHeight:"90vh",maxHeight:"90vh",top:"45%",left:"50%",transform:"translate(-50%, -50%)",borderRadius:10},children:s.jsxs("div",{id:"qr_preview",ref:u,className:"text-center",children:[s.jsxs("h1",{className:"text-5xl",children:["SCAN HERE FOR ",c]}),s.jsx("div",{className:"qr_code",children:s.jsx(B,{value:g||"",size:430})}),s.jsxs("div",{className:"p-3 text-center no-print",children:[s.jsx(w,{className:"no-print",label:"Cancel",title:"Cancel",icon:"pi pi-times-circle",severity:"danger",onClick:()=>t()}),s.jsx(w,{className:"no-print",label:"Print",title:"Print",icon:"pi pi-print",onClick:()=>n()})]})]})})},de=()=>{const h=k(),d=q(),[t,g]=i.useState(),c=i.useRef(null),[n,u]=i.useState([]),{loading:E,PlantList:I}=F(e=>e.plant),[P,y]=i.useState(!1),[j,b]=i.useState(),[O,A]=i.useState(),M=V.useRef(null);i.useEffect(()=>{z()}),i.useEffect(()=>{g(X({screenId:24}))},[]),i.useEffect(()=>{f()},[]);const R=()=>{y(!1)},T=()=>{var e=document.getElementById("qr_preview").innerHTML,r=window.open("","","height=1000, width=1000");r.document.write("<html>"),r.document.write('<body style="padding:60px 20px;margin: 40px auto">'),r.document.write(e),r.document.write("</body><style>@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,700;1,700&display=swap');.no-print {display: none;}.qr_code{margin-top:15px;text-align:center}.text-center{text-align: center}.text-5xl{font-size: 2.5rem !important;text-align: center;font-family: 'Open Sans', sans-serif;font-weight: 700;}</style></html>"),r.document.close(),r.print()},f=()=>{const e={PlantId:0,Taskname:"SearchInitialize",CompanyId:+localStorage.CompanyId};return d(Q(e))};i.useEffect(()=>{t!=null&&t._View&&n.filter(e=>e.name=="view").length==0&&u([...n,{title:"View",name:"view",disabled:!1}]),t!=null&&t._Update&&n.filter(e=>e.name=="edit").length==0&&u([...n,{title:"Edit",name:"edit",disabled:!1}]),t!=null&&t._Delete&&n.filter(e=>e.name=="delete").length==0&&u([...n,{title:"Delete",name:"delete",disabled:!1}]),t!=null&&t._View&&(t!=null&&t._Update)&&(t!=null&&t._Delete)&&x({...m,tableAction:!0})},[t,n]),i.useEffect(()=>{t!=null&&t._Add&&!m.pageHeader.pageActions[0].create&&x(e=>{const r={...e.pageHeader,pageActions:e.pageHeader.pageActions.map(o=>({...o,create:!!(t!=null&&t._Add)}))};return{...e,pageHeader:r}})},[t]),i.useEffect(()=>{x({...m,tableActions:n})},[n]);const[m,x]=i.useState({pageTitle:"Plant",pageHeader:{pageActions:[{create:!1,clear:!1,save:!1,createQuery:"/home/cPlant",createDispatch:()=>d(v({data:null,isView:!1,isCreate:!0}))}]},tableCheckSelection:!1,tableAction:!0,tableActionStyle:{maxWidth:"10rem",textAlign:"center",justifySelf:"center"},tableRows:10,tableRowsOptions:[5,10,25],tablePagination:!0,tableActions:n,tableAddActions:[{title:"Appointment QRCode Print",name:"print",disabled:!1,colOn:"print",id:"appointment_qr"},{title:"Check In/ Out Print",name:"print",disabled:!1,colOn:"print",id:"check_in_out_qr"},{title:"Is Auto Approve",name:"is_auto_approve",disabled:!1,colOn:"is_auto_approve",id:"is_auto_approve"}],tableFenoActions:[{title:"Is Auto Approve",name:"is_auto_approve",disabled:!1,id:"is_auto_approve"}],tableColumns:[{title:"Company",name:"CompanyName",sort:!0,avatar:!1,badge:!1,colStyle:{minWidth:"10rem"}},{title:"Plant Code",name:"PlantCode",sort:!0,avatar:!1,badge:!1,colStyle:{minWidth:"10rem"}},{title:"Plant Name",name:"PlantName",sort:!0,avatar:!1,badge:!1,colStyle:{}},{title:"Created By",name:"CreatedByName",sort:!0,avatar:!0,badge:!1,colStyle:{minWidth:"6rem"}},{title:"Created On",name:"CreatedOn",sort:!0,avatar:!0,badge:!1,colStyle:{minWidth:"6rem"}},{title:"Modified By",name:"ModifiedByName",sort:!0,avatar:!0,badge:!1,colStyle:{minWidth:"6rem"}},{title:"Modified On",name:"ModifiedOn",sort:!0,avatar:!0,badge:!1,colStyle:{minWidth:"6rem"}},{title:"Status",name:"StatusName",sort:!0,avatar:!1,badge:!0,colStyle:{minWidth:"2rem",textAlign:"center"}},{title:"Print",name:"print",sort:!0,avatar:!1,badge:!1,action:!0,colOn:"print",colStyle:{minWidth:"7rem",maxWidth:"8rem",textAlign:"center"}},{title:"Is Auto Approve",name:"is_auto_approve",sort:!0,avatar:!1,badge:!1,action:!0,colOn:"is_auto_approve",colStyle:{minWidth:"7rem",maxWidth:"8rem",textAlign:"center"}}],tableExport:e=>{f().then(o=>{W(o.payload.PlantList).then(a=>{e==="pdf"?N.Export("Plant",a,"pdf"):e==="excel"&&N.Export("Plant",a,"excel")}).catch(a=>{console.error(a.message)})})}}),W=e=>new Promise((r,o)=>{let a=[];e.length>0?(e.forEach(l=>{let p={"Company Name":l.CompanyName,"Plant Code":l.PlantCode,"Plant Name":l.PlantName,"Created By":l.CreatedByName,"Created On":l.CreatedOn,"Modified By":l.ModifiedByName,"Modified On":l.ModifiedOn,Status:l.StatusName};a.push(p)}),r(a)):o(new Error("No data available for export."))}),H={view:e=>{const r={PlantId:e.data.PlantId,Taskname:"CreateInitialize"};d(_(r)).then(a=>{a.payload.transtatus.result==!0&&h.push("/home/cPlant")}).catch(a=>{}),d(v(e))},edit:e=>{const r={PlantId:e.data.PlantId,Taskname:"CreateInitialize"};d(_(r)).then(a=>{a.payload.transtatus.result==!0&&h.push("/home/cPlant")}).catch(a=>{}),d(v(e))},delete:e=>{L(`Are you sure you want to inactive this ${e.data.PlantName}?`,"Confirmation",()=>{let r={PlantId:e.data.PlantId};d(J(r)).then(a=>{var l,p;a.payload.transtatus.result==!0?((l=c.current)==null||l.show({severity:"success",summary:"Success Message",detail:a.payload.transtatus.lstErrorItem[0].Message}),f()):a.payload.transtatus.result==!1&&((p=c.current)==null||p.show({severity:"warn",summary:"Warning Message",detail:a.payload.transtatus.lstErrorItem[0].Message}))}).catch(a=>{var l;(l=c.current)==null||l.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})})},()=>{})},print:e=>{console.log(e.rowItem,e.data),e.rowItem.id=="appointment_qr"?(b("http://127.0.0.1:5173/home/cAppointment"+e.data.UrlToken),A("APPOINTMENT WEBSITE"),y(!0)):e.rowItem.id=="check_in_out_qr"&&(b(e.data.CheckToken),A("CHECK IN/ OUT"),y(!0))},isAutoApprove:e=>{var a;let r,o;e.data==!1?(r={Plant:{...e.rowData,IsAutomaticApprove:!1}},o=1):e.data==!0&&(r={Plant:{...e.rowData,IsAutomaticApprove:!0}},o=0);try{console.log(r),d($(r)).then(p=>{var C,S;p.payload.transtatus.result==!0?((C=c.current)==null||C.show({severity:"success",summary:"Success Message",detail:`Automatic Approve ${o==0?"Enabled":"Dissabled"} Successfully`}),f()):p.payload.transtatus.result==!1&&((S=c.current)==null||S.show({severity:"error",summary:"Error Message",detail:p.payload.transtatus.lstErrorItem[0].Message}),f())})}catch(l){(a=c.current)==null||a.show({severity:"warn",summary:"Error Message",detail:l})}}};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"page-container no-print",children:s.jsxs("div",{className:"inner-page-container",children:[s.jsx(K,{pageTitle:m.pageTitle,pageConfig:m}),s.jsx("div",{className:"form-container scroll-y",children:s.jsx("div",{className:"white",children:s.jsx("div",{className:"widget-body",children:s.jsx("div",{className:"card",children:s.jsx(G,{handleActions:H,data:I,loading:E,pageConfig:m,screenPermissions:t})})})})})]})}),s.jsx(U,{}),s.jsx(Z,{visible:P,handleClosePop:R,qrValue:j,qrTxt:O,handlePrint:T,componentRef:M}),s.jsx(D,{toast:c})]})};export{Z as QRPop,de as default};
