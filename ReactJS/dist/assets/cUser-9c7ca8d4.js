import{a as Fe,u as De,r as m,L as Y,p as Ge,af as Le,b as L,c as Ve,t as _,ah as Me,ai as Re,aj as Ee,ak as ve,al as Oe,j as e,F as Ae,B as H,n as f,A as ke,d as qe}from"./index-25a41ef1.js";import{U as Be}from"./Master-b11b8a2f.js";import{F as Te}from"./fileupload.esm-b904f07b.js";import{D as Je}from"./divider.esm-784108ce.js";import"./index.esm-21a4a4d3.js";import"./index.esm-9a713e1a.js";const rl=()=>{const $=Fe(),g=De(),[ie,j]=m.useState(),[de,b]=m.useState(),[ue,ce]=m.useState(!1),[me,R]=m.useState(),[E,w]=m.useState([]),[v,C]=m.useState([]),[O,P]=m.useState([]),[A,F]=m.useState([]),[pe,k]=m.useState(),[fe,V]=m.useState(null),[W,M]=m.useState(Y.NO_IMG);m.useState();const h=m.useRef(null),[he,N]=m.useState([]),[ye,S]=m.useState([]),[Ye,q]=m.useState([]),[Ie,y]=m.useState(!1),Se=e.jsx("div",{className:"font-bold mb-3",children:"Pick a password"}),be=e.jsxs(e.Fragment,{children:[e.jsx(Je,{}),e.jsx("p",{className:"mt-2",children:"Suggestions"}),e.jsxs("ul",{className:"pl-2 ml-2 mt-0 line-height-3",children:[e.jsx("li",{children:"Minimum 8 characters"}),e.jsx("li",{children:"At least one lowercase"}),e.jsx("li",{children:"At least one uppercase"}),e.jsx("li",{children:"At least one numeric"}),e.jsx("li",{children:"At least one special character"})]})]});m.useEffect(()=>{Ge()}),m.useEffect(()=>{if(I==!0)g(Le({UserId:0}));else if(I==!1){ce(!0),w(t.UserCompanyMaps),C(t.UserPlantMaps),F(t.UserRoleMaps),P(t.UserGateMaps);let s=t.UserCompanyMaps.map(o=>o.CompanyId);Q("CompanyNames",{},s,1);let c=t.UserPlantMaps.map(o=>o.PlantId);Z("PlantNames",{},c,1);let r=t.UserGateMaps.map(o=>o.GateId);le("GateNames",{},r,1);let d=t.UserRoleMaps.map(o=>o.RoleId);ae("RoleNames",{},d,1),we(t.UserImageUrl).then(o=>{const n=new File([o],t.UserImageName,{type:"image/*",lastModified:1695716506050});V(n),M(t.UserImageUrl)}).catch(o=>{console.error("Error fetching image:",o)})}else N(D),q(U),S(x)},[]),L(s=>s.user),L(s=>s.user),L(s=>s.user.CountryList),L(s=>s.user.StatusList);const B=m.useRef(),{isCreate:I,isView:p,createEditData:_e,loading:ge,error:He,StatusList:Ne,UserList:$e,HdrTable:t,EmployeeList:We,CompanyList:z,RoleList:U,PlantList:D,GateList:x,UserRoleMapList:ze,UserCompanyMapList:Ke,UserPlantMapList:Qe,transtatus:Xe,DepartmentList:Ue}=L(s=>s.user);m.useEffect(()=>{N(D)},[D]),m.useEffect(()=>{S(x)},[x]),m.useEffect(()=>{q(U)},[U]);const a=Ve({initialValues:{UserId:t!=null?t.UserId:0,UserName:t!=null?t.UserName:"",UserCode:t!=null?t.UserCode:"",Password:t!=null?t.Password:"",CompanyId:t!=null?t.UserCompanyMaps:null,PlantId:t!=null?t.PlantId:null,GateId:t!=null?t.GateId:null,EmpId:t!=null?t.EmpId:null,DefaultRoleId:t!=null?t.DefaultRoleId:null,UserEmail:t!=null?t.UserEmail:"",UserTelNo:t!=null?t.UserTelNo:"",Status:t!=null?t.Status:1,CreatedBy:t!=null?t.CreatedBy:localStorage.UserId,CreatedOn:t!=null?_(t.CreatedOn):_(new Date),ModifiedBy:t!=null?localStorage.UserId:null,ModifiedOn:t!=null?_(new Date):null,IsBlocked:t!=null?t.IsBlocked:!1,UserImageName:t!=null?t.UserImageName:"",UserImageUrl:t!=null?t.UserImageUrl:"",DeptId:t!=null?t.DeptId:null,SecondaryMobileNo:t!=null?t.SecondaryMobileNo:"",Address:t!=null?t.Address:""},validationSchema:Be,onSubmit:s=>{var n;y(!0);const c=new FormData;if(!(s.RoleNames&&s.CompanyNames&&s.PlantNames&&s.GateNames)){(n=h.current)==null||n.show({severity:"warn",summary:"Warning Message",detail:"Please Ensure that you have selected Atleast Company, Roles, Plants, Gates & their Defaults"}),y(!1);return}let d=JSON.stringify({User:s,UserCompanyMap:E,UserPlantMap:v,UserGateMap:O,UserRoleMap:A});if(c.append("input",d),c.append("webfile",fe),t!=null){if(I==!1){var o=g(Me(c));o.then(i=>{var l,u;y(!1),i.payload.transtatus.result==!0?(y(!1),(l=h.current)==null||l.show({severity:"success",summary:"Success Message",detail:i.payload.transtatus.lstErrorItem[0].Message}),T(),setTimeout(()=>{$.push("/home/vUser")},800)):(y(!1),(u=h.current)==null||u.show({severity:"error",detail:i.payload.transtatus.lstErrorItem[0].Message,summary:"Error"}))}).catch(i=>{var l;(l=h.current)==null||l.show({severity:"error",detail:"Error",summary:JSON.stringify(i)})})}}else{var o=g(Re(c));o.then(l=>{var G,oe;if(y(!1),l.payload.transtatus.result==!0){(G=h.current)==null||G.show({severity:"success",detail:l.payload.transtatus.lstErrorItem[0].Message,summary:"Success Messsage"});{console.log(),l.payload.HdrTable.UserId;let Pe={NewUserId:l.payload.HdrTable.UserId,RoleId:l.payload.HdrTable.DefaultRoleId};var u=g(Ee(Pe));u.then(J=>{if(J.payload.transtatus.result!=!0){y(!1);return}}).catch(J=>{var ne;(ne=h.current)==null||ne.show({severity:"error",detail:"Error",summary:JSON.stringify(J)})})}T()}else{y(!1),(oe=h.current)==null||oe.show({severity:"error",summary:"Error",detail:l.payload.transtatus.lstErrorItem[0].Message}),y(!1);return}}).catch(l=>{var u;(u=h.current)==null||u.show({severity:"error",detail:"Error",summary:JSON.stringify(l)})})}}}),T=()=>{delete a.values.RoleNames,delete a.values.CompanyNames,delete a.values.PlantNames,delete a.values.GateNames,a.resetForm(),V(null),M(Y.NO_IMG),R(null),j(null),b(null),k(null),N([]),S([]),q([])},K=(s,c,r)=>{a.setFieldValue(s,r)},Q=(s,c,r,d=0)=>{a.setFieldValue("CompanyId",null),a.setFieldValue("PlantNames",[]),a.setFieldValue("PlantId",null),a.setFieldValue("GateNames",[]),a.setFieldValue("GateId",null),a.setFieldValue(s,r),w([]),N([]),j(null),S([]),b(null);let o=[];for(let n=0;n<r.length;n++){const i=r[n];let l={};l.UserCompanyMapId=0,l.CompanyId=i,l.UserId=0,l.Accountingyear=new Date().getFullYear,l.IsDefault=!1,l.Status=1,o.push(l)}w(o),R(null),R(z.filter(n=>r.some(i=>i==n.CompanyId))),!I&&d==1&&X("CompanyId",{},t.CompanyId,o)},X=(s,c,r,d=[])=>{a.setFieldValue("PlantNames",[]),a.setFieldValue("PlantId",null),a.setFieldValue("GateNames",[]),a.setFieldValue("GateId",null),a.setFieldValue(s,r),w(null),N([]),j(null),S([]),b(null);let o=(d.length>0?d:E).find(l=>l.CompanyId==r);if(o){let l=(d.length>0?d:E).filter(u=>u.CompanyId!=r);l.forEach(u=>u.IsDefault=!1),o.IsDefault=!0,l.push(o),w(l)}var i=g(ve({Companyid:r}));i.then(l=>{N(l.payload.PlantList)}).catch(l=>{var u;(u=h.current)==null||u.show({severity:"error",detail:"Error",summary:JSON.stringify(l)})})},Z=(s,c,r,d=0)=>{a.setFieldValue("PlantId",null),a.setFieldValue("GateNames",[]),a.setFieldValue("GateId",null),a.setFieldValue(s,r),S([]),b(null),C(null);let o=[];for(let n=0;n<r.length;n++){const i=r[n];let l={};l.UserPlantMapId=0,l.CompanyId=D.find(u=>u.PlantId==i).CompanyId,l.UserId=0,l.PlantId=i,l.AccountingYear=new Date().getFullYear(),l.IsDefault=!1,l.Status=1,o.push(l)}C(o),j(null),j(D.filter(n=>r.some(i=>i==n.PlantId))),!I&&d==1&&ee("PlantId",{},t.PlantId,o)},ee=(s,c,r,d=[])=>{a.setFieldValue("GateNames",[]),a.setFieldValue("GateId",null),a.setFieldValue(s,r),S([]),b(null),C(null);let o=(d.length>0?d:v).find(u=>u.PlantId==r),n=(d.length>0?d:v).filter(u=>u.PlantId!=r);n.forEach(u=>u.IsDefault=!1),o.IsDefault=!0,n.push(o),C(n);var l=g(Oe({Plantid:r}));l.then(u=>{S(u.payload.GateList)}).catch(u=>{var G;(G=h.current)==null||G.show({severity:"error",detail:"Error",summary:JSON.stringify(u)})})},le=(s,c,r,d=0)=>{a.setFieldValue("GateId",null),a.setFieldValue(s,r),P(null);let o=[];for(let n=0;n<r.length;n++){const i=r[n];let l={};l.UserGateMapId=0,l.CompanyId=x.find(u=>u.GateId==i).CompanyId,l.UserId=0,l.PlantId=x.find(u=>u.GateId==i).PlantId,l.GateId=i,l.AccountingYear=new Date().getFullYear(),l.IsDefault=!1,l.Status=1,o.push(l)}P(o),b(null),b(x.filter(n=>r.some(i=>i==n.GateId))),!I&&d==1&&te("GateId",{},t.GateId,o)},te=(s,c,r,d=[])=>{P(null),a.setFieldValue(s,r);let o=(d.length>0?d:O).find(i=>i.GateId==r),n=(d.length>0?d:O).filter(i=>i.GateId!=r);n.forEach(i=>i.IsDefault=!1),o.IsDefault=!0,n.push(o),P(n)},ae=(s,c,r,d=0)=>{a.setFieldValue("DefaultRoleId",null),a.setFieldValue(s,r),F(null);let o=[];for(let n=0;n<r.length;n++){const i=r[n];let l={};l.UserRoleMapId=0,l.CompanyId=U.find(u=>u.RoleId==i).CompanyId,l.UserId=0,l.RoleId=i,l.AccountingYear=new Date().getFullYear(),l.IsDefault=!1,l.Status=1,o.push(l)}F(o),k(null),k(U.filter(n=>r.some(i=>i==n.RoleId))),!I&&d==1&&se("DefaultRoleId",{},t.DefaultRoleId,o)},se=(s,c,r,d=[])=>{F(null),a.setFieldValue(s,r);let o=(d.length>0?d:A).find(i=>i.RoleId==r),n=(d.length>0?d:A).filter(i=>i.RoleId!=r);n.forEach(i=>i.IsDefault=!1),o.IsDefault=!0,n.push(o),F(n)},re=()=>{var s;(s=B.current)==null||s.clear(),M(Y.NO_IMG),V(null),a.setFieldValue("UserImageName",""),a.setFieldValue("UserImageUrl","")},xe=(s,c)=>{const r=s.name.slice((s.name.lastIndexOf(".")-1>>>0)+2).toLowerCase(),d=s.type.toLowerCase();return c.includes(r)||c.includes(d)},je=s=>{var r,d,o;const c=["jpeg","jpg","png"];if(W!=""&&re(),s.files&&!xe(s.files[0],c)){(r=h.current)==null||r.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG)"}),(d=B.current)==null||d.clear();return}if(s.files.length>0){V(s.files[0]),a.setFieldValue("UserImageName",s.files[0].name),a.setFieldValue("UserImageUrl",s.files[0].name);const n=URL.createObjectURL(s.files[0]);M(n)}else{(o=h.current)==null||o.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG)"});return}};async function we(s){const c=await fetch(s);if(!c.ok)throw new Error(`Failed to fetch image: ${c.statusText}`);return await c.blob()}const Ce={icon:"las la-camera-retro",iconOnly:!0};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{initialValues:a.initialValues,validationSchema:a.validationSchema,onSubmit:a.handleSubmit,children:e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsxs("div",{className:"grid grid-nogutter",children:[e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"User"})}),e.jsx("div",{className:"md:col-6 text-right",children:e.jsxs("div",{className:"action-btn",children:[e.jsxs(e.Fragment,{children:[e.jsx(H,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",disabled:!!(p||Ie),type:"submit",onClick:()=>a.handleSubmit()}),e.jsx(H,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:ue||p,onClick:()=>T()})]}),e.jsx(H,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{$.push("/home/vUser")}})]})})]})}),e.jsx("div",{className:"form-container scroll-y",children:e.jsx("form",{children:e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsx("div",{className:"grid",children:ge?e.jsx(ke,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-12 md:col-3",children:e.jsxs("div",{className:"img-preview-container m-auto",children:[e.jsx(Te,{mode:"basic",name:"demo[]",url:"#",chooseOptions:Ce,className:"custom-upload inline-block",accept:"image/jpeg, image/png, image/jpg",auto:!0,chooseLabel:"Upload Photo",onSelect:je,disabled:!!p,customUpload:!0,ref:B}),e.jsx("div",{className:"img-preview-hidden",children:e.jsx("img",{src:W,alt:"logo",className:"w-full"})}),e.jsx("a",{className:`${p?"p-disabled":null} img-preview-close`,onClick:re,children:e.jsx("i",{className:"las la-times-circle"})})]})}),e.jsx("div",{className:"col-9 md:col-9",children:e.jsxs("div",{className:"grid",children:[e.jsx(f,{type:"text",name:"UserCode",label:"User Code",options:"",show:!1,required:!0,disable:!1,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-3"}),e.jsx(f,{type:"text",name:"UserName",label:"User Name",show:!0,required:!0,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"password",name:"Password",label:"Password",show:!0,required:!0,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",feedback:!0,formik:a,fldStyle:"col-12 md:col-4",header:Se,footer:be}),e.jsx(f,{type:"select",name:"DeptId",label:"Department",options:Ue,show:!0,required:!0,disable:!!p,optionLabel:"DepartmentName",optionValue:"DepartmentId",handleSelect:K,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"text",name:"UserEmail",label:"E-Mail ID",options:"",show:!0,required:!0,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"text",name:"UserTelNo",label:"Mobile Number",options:"",show:!0,required:!0,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-4",maxlength:15,minLength:9,keyfilter:"int"}),e.jsx(f,{type:"text",name:"SecondaryMobileNo",label:"Secondary Mobile Number",options:"",show:!0,required:!1,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-4",maxlength:15,minLength:9,keyfilter:"int"})]})}),e.jsx("div",{className:"col-9 md:col-9",children:e.jsxs("div",{className:"grid",children:[e.jsx(f,{type:"multi_select",name:"CompanyNames",label:"Company Name",options:z,show:!0,required:!0,disable:!!p,optionLabel:"CompanyName",optionValue:"CompanyId",handleSelect:Q,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"select",name:"CompanyId",label:"Default Company",options:me,show:!0,required:!0,disable:!!p,optionLabel:"CompanyName",optionValue:"CompanyId",handleSelect:X,showFilter:!0,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"multi_select",name:"PlantNames",label:"Plant Name",options:he,show:!0,required:!0,disable:!!p,optionLabel:"PlantName",optionValue:"PlantId",handleSelect:Z,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"select",name:"PlantId",label:"Default Plant",options:ie,show:!0,required:!0,disable:!!p,optionLabel:"PlantName",optionValue:"PlantId",showFilter:!0,handleSelect:ee,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"multi_select",name:"RoleNames",label:"Role Name",options:U,show:!0,required:!0,disable:!!p,optionLabel:"RoleName",optionValue:"RoleId",handleSelect:ae,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"select",name:"DefaultRoleId",label:"Default Role",options:pe,show:!0,required:!0,disable:!!p,optionLabel:"RoleName",optionValue:"RoleId",handleSelect:se,showFilter:!0,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"multi_select",name:"GateNames",label:"Gate Name",options:ye,show:!0,required:!0,disable:!!p,optionLabel:"GateName",optionValue:"GateId",handleSelect:le,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"select",name:"GateId",label:"Default Gate",options:de,show:!0,required:!0,disable:!!p,optionLabel:"GateName",optionValue:"GateId",showFilter:!0,handleSelect:te,formik:a,fldStyle:"col-12 md:col-4"}),e.jsx(f,{type:"select",name:"Status",label:"Status",options:Ne,show:!0,required:!0,disable:!!p||I==null||I==!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:K,formik:a,fldStyle:"col-12 md:col-4"})]})}),e.jsx(f,{type:"textarea",name:"Address",label:"Address",options:"",show:!0,required:!0,disable:!!p,optionLabel:"",optionValue:"",handleSelect:"",formik:a,fldStyle:"col-12 md:col-3",maxlength:"500",style:{maxHeight:"100px",overflowY:"auto"}})]})})})})})})})]})})}),e.jsx(qe,{toast:h})]})};export{rl as default};
