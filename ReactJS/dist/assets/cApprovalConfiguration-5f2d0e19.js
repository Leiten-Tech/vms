import{u as ne,r as g,a as de,b as ce,p as ue,d3 as me,c as te,j as e,B as R,A as pe,d as ye,F as ae,n as x,d5 as he,d6 as Ie,d7 as ve}from"./index-25a41ef1.js";import{n as re,o as fe}from"./Master-b11b8a2f.js";import{D as Se,C as O}from"./column.esm-11a46c7b.js";import"./index.esm-21a4a4d3.js";import"./index.esm-9a713e1a.js";const ge=(I,i,h,d)=>{const v=()=>{h([]),h(i.filter(D=>D!=I))};return e.jsx(R,{label:"",severity:"danger",title:"Delete",icon:"las la-trash",className:"mr-2 p-1",disabled:!!d,onClick:()=>v()})},Le=I=>{const{isCreate:i,isView:h,createEditData:d,loading:v,error:D,StatusList:T,PlantList:p,DocumentList:U,ActivityList:F,LevelList:b,HdrTable:q,DetailList:Z,ApprovalList:z,transtatus:B,approvalForm:L,formik:y,handleSelect:N,approvalDetailList:P,handlePlantSelect:w}=I;return e.jsx(ae,{initialValues:L,validationSchema:re,onSubmit:y.handleSubmit,children:e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsxs("div",{className:"grid",children:[e.jsx(x,{type:"select",name:"PlantId",label:"Plant Name",options:p,show:!0,required:!0,disable:!!h,optionLabel:"PlantName",optionValue:"PlantId",handleSelect:w,formik:y,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"DocumentId",label:"Document Name",options:U,show:!0,required:!0,disable:!!h,optionLabel:"FunctionName",optionValue:"FunctionId",handleSelect:N,formik:y,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"ApprovalActivityId",label:"Operation / Activity",options:F,show:!0,required:!0,disable:!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:N,formik:y,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"Status",label:"Status",options:T,show:!0,required:!0,disable:!!h||i==null||i==!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:N,formik:y,fldStyle:"col-12 md:col-3"})]})})})})})},Ue=I=>{const{filters:i,TableHeader:h,OnAdd:d,OnClear:v,onRowSelect:D,isCreate:T,isView:p,createEditData:U,loading:F,error:b,StatusList:q,PlantList:Z,DocumentList:z,ActivityList:B,LevelList:L,HdrTable:y,DetailList:N,ApprovalList:P,transtatus:w,approvalForm:K,formik:f,handleDSelect:H,approvalDetailList:W,RoleList:V,primaryUserList:o,handleRoleSelect:M,tempUserList:Q,handlePrimaryUserSelect:X,tempUserListSecondary:E,setApprovalDetailList:A,rowselect:k}=I;return e.jsx(ae,{initialValues:f.approvalDetailForm,validationSchema:f.ApprovalDetailValidationSchema,onSubmit:f.handleSubmit,children:e.jsx("div",{className:"white",children:e.jsxs("div",{className:"widget-body",children:[e.jsxs("div",{className:"normal-table",children:[e.jsx("div",{className:"page-title",children:e.jsx("div",{className:"grid grid-nogutter",children:e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Approval Detail"})})})}),e.jsxs("div",{className:"grid",children:[e.jsx(x,{type:"select",name:"LevelId",label:"Level Name",options:L,show:!0,required:!0,disable:!!p||k,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:H,formik:f,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"RoleId",label:"Role Name",options:V,show:!0,required:!0,disable:!!p,optionLabel:"RoleName",optionValue:"RoleId",handleSelect:M,formik:f,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"PrimaryUserId",label:"Primary User Name",options:Q,show:!0,required:!0,disable:!!p,optionLabel:"UserName",optionValue:"UserId",handleSelect:X,formik:f,fldStyle:"col-12 md:col-3"}),e.jsx(x,{type:"select",name:"SecondaryUserId",label:"Secondary User Name",options:E,show:!0,required:!1,disable:!!p,optionLabel:"UserName",optionValue:"UserId",handleSelect:H,formik:f,fldStyle:"col-12 md:col-3"})]}),e.jsxs("div",{className:"text-center mb-3",children:[e.jsx(R,{label:"Add",severity:"success",icon:"las la-plus",title:"Add",className:"text-center",onClick:f.handleSubmit,type:"submit",disabled:p}),e.jsx(R,{label:"Clear",severity:"danger",icon:"las la-trash",title:"Clear",className:"text-center",onClick:()=>v(),disabled:!!(p||k)})]})]}),e.jsx("div",{className:"card",children:e.jsxs(Se,{value:W,showGridlines:!0,paginator:!0,filters:i,filterDisplay:"menu",globalFilterFields:["LevelName","RoleName","UserName","SecUserName"],header:h,emptyMessage:"No Data Found.",rows:5,rowsPerPageOptions:[5,10,25,50],tableStyle:{minWidth:"50rem"},children:[e.jsx(O,{header:"Action",style:{textAlign:"center"},body:G=>ge(G,W,A,p)}),e.jsx(O,{field:"LevelName",header:"Level"}),e.jsx(O,{field:"RoleName",header:"Role"}),e.jsx(O,{field:"UserName",header:"Primary User"}),e.jsx(O,{field:"SecUserName",header:"Secondary User"})]})})]})})})},Ce=()=>{const I=ne(),i=g.useRef(null),h=de(),[d,v]=g.useState([]),[D,T]=g.useState([]),[p,U]=g.useState([]),[F,b]=g.useState([]),[q,Z]=g.useState(-1),[z,B]=g.useState(!1),{isCreate:L,isView:y,createEditData:N,loading:P,error:w,StatusList:K,PlantList:f,DocumentList:H,ActivityList:W,LevelList:V,HdrTable:o,DetailList:M,ApprovalList:Q,transtatus:X,RoleList:E,PrimaryUserList:A}=ce(r=>r.approval);g.useEffect(()=>{ue()}),g.useEffect(()=>{T(A)},[A]),g.useEffect(()=>{if(L==!0){const r={ApprovalConfigurationId:0,CompanyId:+localStorage.CompanyId,Taskname:"CREATEINITIALIZE"};I(me(r))}else{let r=[];for(let S=0;S<M.length;S++){const t=M[S];let l={};l.ApprovalConfigurationDetailId=0,l.ApprovalConfigurationId=t.ApprovalConfigurationId??0,l.LevelId=t.LevelId,l.RoleId=t.RoleId,l.PrimaryUserId=t.PrimaryUserId,l.SecondaryUserId=t.SecondaryUserId,l.LevelName=V.find(n=>n.MetaSubId==t.LevelId).MetaSubDescription,l.RoleName=E.find(n=>n.RoleId==t.RoleId).RoleName,l.UserName=A.find(n=>n.UserId==t.PrimaryUserId).UserName,l.SecondaryUserId&&(l.SecUserName=A.find(n=>n.UserId==t.SecondaryUserId).UserName),r.push(l)}v(r)}},[]);const k={ApprovalConfigurationId:o!=null?o.ApprovalConfigurationId:0,CompanyId:o!=null?o.CompanyId:localStorage.CompanyId,PlantId:o!=null?o.PlantId:+localStorage.PlantId,DocumentId:o!=null?o.DocumentId:null,ApprovalActivityId:o!=null?o.ApprovalActivityId:70,Status:o!=null?o.Status:1,CreatedBy:o!=null?o.CreatedBy:localStorage.UserId,CreatedOn:o!=null?o.CreatedOn:new Date,ModifiedBy:o!=null?localStorage.UserId:null,ModifiedOn:o!=null?new Date:null},G={ApprovalConfigurationDetailId:0,ApprovalConfigurationId:0,LevelId:67,RoleId:null,PrimaryUserId:null,SecondaryUserId:null,Status:null},j=te({initialValues:k,validationSchema:re,onSubmit:(r,{resetForm:S})=>{var n;let t=[];if(!d||!d.length||d.length==0){(n=i.current)==null||n.show({severity:"error",summary:"Error Message",detail:"Please Add Atleast One Item In The Grid."});return}for(let m=0;m<d.length;m++){const s=d[m];let a={};a.ApprovalConfigurationDetailId=0,a.ApprovalConfigurationId=0,a.LevelId=s.LevelId,a.RoleId=s.RoleId,a.PrimaryUserId=s.PrimaryUserId,a.SecondaryUserId=s.SecondaryUserId,a.Status=s.Status,t.push(a)}let l={ApprovalConfiguration:r,ApprovalConfigurationDetail:t};L==!1?I(he(l)).then(s=>{var a,c;(s.payload!=null||!s.payload)&&(s.payload.transtatus.result==!0?((a=i.current)==null||a.show({severity:"success",summary:"Success Message",detail:s.payload.transtatus.lstErrorItem[0].Message}),setTimeout(()=>{h.push("/home/vApprovalConfiguration")},800)):(c=i.current)==null||c.show({severity:"error",summary:"Error Message",detail:s.payload.transtatus.lstErrorItem[0].Message}))}).catch(s=>{var a;(a=i.current)==null||a.show({severity:"error",summary:"Error Message",detail:s})}):I(Ie(l)).then(s=>{var a,c;s.payload.transtatus.result==!0?((a=i.current)==null||a.show({severity:"success",summary:"Success Message",detail:s.payload.transtatus.lstErrorItem[0].Message}),Y()):s.payload.transtatus.result==!1&&((c=i.current)==null||c.show({severity:"error",summary:"Error Message",detail:s.payload.transtatus.lstErrorItem[0].Message}))}).catch(s=>{var a;(a=i.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(s)})})}}),Y=()=>{j.resetForm(),u.resetForm(),U([]),b([]),v([])},u=te({initialValues:G,validationSchema:fe,onSubmit:(r,{resetForm:S})=>{var l,n,m,s;let t={};if(t.ApprovalConfigurationDetailId=0,t.LevelId=r.LevelId,t.RoleId=r.RoleId,t.PrimaryUserId=r.PrimaryUserId,t.SecondaryUserId=r.SecondaryUserId,t.LevelName=V.find(a=>a.MetaSubId==r.LevelId).MetaSubDescription,t.RoleName=E.find(a=>a.RoleId==r.RoleId).RoleName,t.UserName=p.find(a=>a.UserId==r.PrimaryUserId).UserName,r.SecondaryUserId&&(t.SecUserName=F.find(a=>a.UserId==r.SecondaryUserId).UserName),q==-1){let a=d.filter(C=>C.LevelName==t.LevelName)||[],c=d.filter(C=>C.UserName==t.UserName)||[];if(a.length>0){(l=i.current)==null||l.show({severity:"warn",summary:"Warning Message",detail:"Level Already Exists"});return}if(c.length>0){(n=i.current)==null||n.show({severity:"warn",summary:"Warning Message",detail:"User Name Already Exists"});return}v([...d,t])}else{let a=d.filter(J=>J.LevelName==t.LevelName&&J.ApprovalConfigurationDetailId!=t.ApprovalConfigurationDetailId)||[],c=d.filter(J=>J.UserName==t.UserName)||[];if(a.length>0){(m=i.current)==null||m.show({severity:"warn",summary:"Warning Message",detail:"Level Already Exists"});return}if(c.length>0){(s=i.current)==null||s.show({severity:"warn",summary:"Warning Message",detail:"User Name Already Exists"});return}let C=d;C[q]=t,v(C)}_(),B(!1)}}),_=()=>{u.resetForm(),U([]),b([])},se=(r,S,t)=>{j.setFieldValue(r,t)},le=(r,S,t)=>{j.setFieldValue(r,t),u.setFieldValue("RoleId",""),u.setFieldValue("PrimaryUserId",""),u.setFieldValue("SecondaryUserId",""),U([]),b([])},ie=(r,S,t)=>{u.setFieldValue(r,t)},$=(r,S,t,l=[])=>{u.setFieldValue(r,t);let n=[];l.length>0?n=l.filter(m=>m.UserId!=t):n=p.filter(m=>m.UserId!=t),b(n)},ee=(r,S,t,l,n)=>{u.setFieldValue(r,t);let m={RoleId:t,PlantId:j.values.PlantId};I(ve(m)).then(a=>{var c;a.payload.transtatus.result==!0?(U(a.payload.PrimaryUserList),l&&$("PrimaryUserId",{},n,a.payload.PrimaryUserList),b([])):a.payload.transtatus.result==!1&&((c=i.current)==null||c.show({severity:"error",summary:"Error Message",detail:a.payload.transtatus.lstErrorItem[0].Message}))}).catch(a=>{var c;(c=i.current)==null||c.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})})},oe=r=>{y||(u.setFieldValue("",r),u.setFieldValue("ApprovalConfigurationDetailId",r.data.ApprovalConfigurationDetailId),u.setFieldValue("ApprovalConfigurationId",r.data.ApprovalConfigurationId),u.setFieldValue("LevelId",r.data.LevelId),ee("RoleId",{},r.data.RoleId,1,r.data.PrimaryUserId),u.setFieldValue("SecondaryUserId",r.data.SecondaryUserId),Z(r.index),B(!0))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsxs("div",{className:"grid grid-nogutter",children:[e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Approval Configuration"})}),e.jsx("div",{className:"md:col-6 text-right",children:e.jsxs("div",{className:"action-btn",children:[e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",type:"submit",onClick:()=>j.handleSubmit(),disabled:!!y}),e.jsx(R,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:!!(y||L==!1),onClick:()=>Y()})]}),e.jsx(R,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{h.push("/home/vApprovalConfiguration")}})]})})]})}),P?e.jsx(pe,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-container scroll-y",children:[e.jsx(Le,{isCreate:L,isView:y,createEditData:N,loading:P,error:w,HdrTable:o,StatusList:K,PlantList:f,DocumentList:H,ActivityList:W,approvalForm:k,formik:j,handleSelect:se,handlePlantSelect:le}),e.jsx(Ue,{isCreate:L,isView:y,createEditData:N,loading:P,error:w,StatusList:K,HdrTable:o,handleDSelect:ie,DetailList:M,approvalDetailForm:G,formik:u,LevelList:V,setApprovalDetailList:v,approvalDetailList:d,RoleList:E,primaryUserList:D,PrimaryUserList:A,OnClear:_,handleRoleSelect:ee,tempUserList:p,setTempUserList:U,handlePrimaryUserSelect:$,tempUserListSecondary:F,onRowSelect:oe,rowselect:z})]})})]})}),e.jsx(ye,{toast:i})]})};export{Ce as default};
