import{u as ue,r,b as pe,p as he,c as fe,aJ as me,a9 as xe,j as a,F as ve,B as J,aK as K,aL as ge,A as Se,d as je,aM as u,aN as ye,aO as Ce,aP as Ue,I as Ne}from"./index-25a41ef1.js";import{D as be,C as c}from"./column.esm-11a46c7b.js";import{f as Me}from"./Master-b11b8a2f.js";import"./index.esm-9a713e1a.js";import"./index.esm-21a4a4d3.js";const Fe=()=>{const U=ue(),C=r.useRef(null),{ModuleList:b,RoleMasterList:M,UserList:w,loading:_,UserScreens:V}=pe(e=>e.userScreenMapping);r.useEffect(()=>{he()});const[q,z]=r.useState([]),[I,Q]=r.useState(!1),[X,D]=r.useState([]);r.useState([]);const[P,R]=r.useState(null),[Y,F]=r.useState(""),[Z,$]=r.useState([]),[we,A]=r.useState(null),[p,d]=r.useState([]),t=fe({initialValues:{Role:null,User:null,Module:null},validationSchema:Me,onSubmit:(e,{resetForm:l})=>{oe()}});r.useEffect(()=>{V!=null&&(Q(!1),d(V))},[V]),r.useEffect(()=>{U(me({})),d([])},[]),r.useEffect(()=>{M!=null&&z(M)},[M]),r.useEffect(()=>{w!=null&&D(w)},[w]),r.useEffect(()=>{b!=null&&$(b)},[b]);const ee=e=>{const l=e.target.value;let i={...k};i.global.value=l,le(i),se(l)},[ae,se]=r.useState(""),te=(()=>a.jsx("div",{className:"flex justify-content-start",children:a.jsxs("span",{className:"p-input-icon-left",children:[a.jsx("i",{className:"pi pi-search"}),a.jsx(Ne,{value:ae,onChange:ee,placeholder:"Search"})]})}))(),[k,le]=r.useState({global:{value:null,matchMode:xe.CONTAINS}}),[L,h]=r.useState(!1),[E,f]=r.useState(!1),[W,m]=r.useState(!1),[B,x]=r.useState(!1),[T,v]=r.useState(!1),[O,g]=r.useState(!1),S=e=>a.jsxs("div",{children:[a.jsx("div",{children:e}),e=="Create"?a.jsx(u,{value:e,checked:L,onChange:()=>{y(e)}}):e=="Update"?a.jsx(u,{value:e,checked:E,onChange:()=>{y(e)}}):e=="Delete"?a.jsx(u,{value:e,checked:W,onChange:()=>{y(e)}}):e=="View"?a.jsx(u,{value:e,checked:B,onChange:()=>{y(e)}}):e=="Print"?a.jsx(u,{value:e,checked:T,onChange:()=>{y(e)}}):e=="Approval"?a.jsx(u,{value:e,checked:O,onChange:()=>{y(e)}}):""]}),j=(e,l)=>a.jsx(u,{checked:e[l],onChange:()=>re(e,l,[])}),re=(e,l,i)=>{const o=(i.length>0?i:p).map(n=>n===e?{...n,[l]:!n[l]}:n);d(o);const s=o.every(n=>n[l]);l=="Create"&&h(s),l=="Update"&&f(s),l=="Delete"&&m(s),l=="View"&&x(s),l=="Print"&&v(s),l=="Approval"&&g(s)},ne=e=>{t.setFieldValue("User",e.value),F(e.value)},y=e=>{const l=p.every(o=>o[e]),i=p.map(o=>({...o,[e]:!l}));d(i),e=="Create"&&h(!L),e=="Update"&&f(!E),e=="Delete"&&m(!W),e=="View"&&x(!B),e=="Print"&&v(!T),e=="Approval"&&g(!O)},oe=()=>{var o;if(!p.some(s=>s.Create||s.Update||s.Delete||s.View||s.Print||s.Approval)){(o=C.current)==null||o.show({severity:"warn",detail:"At least one item must be selected",summary:"Warning Message"});return}const l=p.map(s=>({UserScreenMappingId:0,UserId:t.values.User,RoleId:s.RoleId,CompanyId:+localStorage.CompanyId,ModuleId:s.ModuleId,ScreenId:s.ScreenId,Create:s.Create,Update:s.Update,Delete:s.Delete,View:s.View,Print:s.Print,Approval:s.Approval,Status:1,CreatedBy:+localStorage.UserId,CreatedOn:new Date,ModifiedBy:+localStorage.UserId,ModifiedOn:new Date}));U(ye({UserScreenMapping:l})).then(s=>{var n,N;(s.payload!=null||!s.payload)&&(s.payload.transtatus.result==!0?((n=C.current)==null||n.show({severity:"success",summary:"Success Message",detail:s.payload.transtatus.lstErrorItem[0].Message}),H()):s.payload.transtatus.result==!1&&((N=C.current)==null||N.show({severity:"warn",summary:"Error Message",detail:s.payload.transtatus.lstErrorItem[0].Message})))}).catch(s=>{var n;(n=C.current)==null||n.show({severity:"warn",summary:"Error Message",detail:JSON.stringify(s.payload)})})},ie=e=>{if(e.value.length==0?t.setFieldValue("Module",null):t.setFieldValue("Module",e.value),A(e.value),t.values.User){let l={RoleId:P,UserId:Y,ModuleId:e.value};G(l)}else d([])},G=e=>{var l=U(Ce(e));l.then(i=>{if(i.payload.transtatus.result){let o=i.payload.UserScreens;o=o.map(n=>({...n,Create:n.Create==1,Update:n.Update==1,Delete:n.Delete==1,View:n.View==1,Print:n.Print==1,Approval:n.Approval==1})),d(o);const s=(n,N)=>n.every(ce=>ce[N]===!0);s(o,"Create")?h(!0):h(!1),s(o,"Update")?f(!0):f(!1),s(o,"Delete")?m(!0):m(!1),s(o,"View")?x(!0):x(!1),s(o,"Print")?v(!0):v(!1),s(o,"Approval")?g(!0):g(!1)}}).catch(i=>{})},H=()=>{t.resetForm(),t.setFieldValue("Role",null),t.setFieldValue("User",null),t.setFieldValue("Module",null),d([]),R([]),F(""),A([]),D([]),h(!1),f(!1),m(!1),x(!1),v(!1),g(!1)},de=e=>{t.setFieldValue("User",null),t.setFieldValue("Module",null),t.setFieldValue("Role",e.target.value),d([]),R(e.value),U(Ue({RoleId:e.value,PlantId:localStorage.PlantId})),A([]),D([]),h(!1),f(!1),m(!1),x(!1),v(!1),g(!1)};return a.jsx(a.Fragment,{children:a.jsx(ve,{initialValues:t.initialValues,validationSchema:t.validationSchema,onSubmit:t.handleSubmit,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"page-container",children:a.jsxs("div",{className:"inner-page-container",children:[a.jsx("div",{className:"page-title",children:a.jsxs("div",{className:"grid grid-nogutter",children:[a.jsx("div",{className:"md:col-6",children:a.jsx("h1",{children:"User Wise Screen Mapping"})}),a.jsx("div",{className:"md:col-6 text-right",children:a.jsxs("div",{className:"action-btn",children:[a.jsx(J,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",disabled:I,type:"submit",onClick:()=>t.handleSubmit()}),a.jsx(J,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:I,onClick:()=>H()})]})})]})}),a.jsx("div",{className:"form-container scroll-y",children:a.jsx("div",{className:"white",children:a.jsxs("div",{className:"widget-body",children:[a.jsx("form",{children:a.jsxs("div",{className:"grid",children:[a.jsxs("div",{className:"col-12 md:col-3",children:[a.jsxs("label",{className:"form-label",children:["User Role ",a.jsx("span",{className:"hlt-txt",children:"*"})]}),a.jsx(K,{name:"Role",value:t.values.Role,options:q,optionLabel:"RoleName",optionValue:"RoleId",filter:!0,onBlur:t.handleBlur,placeholder:"Select Role",className:"w-full",onChange:e=>de(e)}),a.jsx("small",{className:"p-error",children:t.touched&&t.touched.Role&&t.errors&&t.errors.Role})]}),a.jsxs("div",{className:"col-12 md:col-3",children:[a.jsxs("label",{className:"form-label",children:["User Name ",a.jsx("span",{className:"hlt-txt",children:"*"})]}),a.jsx(K,{value:t.values.User,options:X,optionLabel:"UserName",optionValue:"UserId",name:"User",filter:!0,placeholder:"Select User",className:"w-full",onBlur:t.handleBlur,onChange:e=>{ne(e),t.values.Module&&t.values.Module.length>0&&G({RoleId:P,UserId:e.value,ModuleId:t.values.Module})}}),a.jsx("small",{className:"p-error",children:t.touched&&t.touched.User&&t.errors&&t.errors.User})]}),a.jsxs("div",{className:"col-12 md:col-3",children:[a.jsxs("label",{className:"form-label",children:["Module Name ",a.jsx("span",{className:"hlt-txt",children:"*"})]}),a.jsx(ge,{value:t.values.Module,name:"Module",onChange:e=>ie(e),options:Z,optionLabel:"FunctionName",filter:!0,onBlur:t.handleBlur,placeholder:"Select Modules",className:"w-full",optionValue:"FunctionId",maxSelectedLabels:3}),a.jsx("small",{className:"p-error",children:t.touched&&t.touched.Module&&t.errors&&t.errors.Module})]})]})}),a.jsx("div",{className:"card",children:_?a.jsx(Se,{}):a.jsxs(be,{value:p,showGridlines:!0,paginator:!0,filters:k,filterDisplay:"menu",globalFilterFields:["ModuleName","ScreenName","Create","Update","Delete","View","Print","Approval"],header:te,emptyMessage:"No Data found.",rows:50,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Entries",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",rowsPerPageOptions:[5,10,25,50,100],tableStyle:{minWidth:"50rem"},children:[a.jsx(c,{field:"ModuleName",header:"Module",style:{minWidth:"15em",maxWidth:"15em",width:"15em",textAlign:"left",justifyContent:"left",gap:"10px"}}),a.jsx(c,{field:"ScreenName",header:"Screen",style:{minWidth:"15em",maxWidth:"15em",width:"15em",textAlign:"left",justifyContent:"left",gap:"10px"}}),a.jsx(c,{field:"Create",header:S("Create"),style:{textAlign:"center",maxWidth:"3rem"},body:e=>j(e,"Create")}),a.jsx(c,{field:"Update",header:S("Update"),style:{textAlign:"center",maxWidth:"3rem"},body:e=>j(e,"Update")}),a.jsx(c,{field:"Delete",header:S("Delete"),body:e=>j(e,"Delete"),style:{textAlign:"center",maxWidth:"3rem"}}),a.jsx(c,{field:"View",header:S("View"),body:e=>j(e,"View"),style:{textAlign:"center",maxWidth:"3rem"}}),a.jsx(c,{field:"Print",header:S("Print"),body:e=>j(e,"Print"),style:{textAlign:"center",maxWidth:"3rem"}}),a.jsx(c,{field:"Approval",header:S("Approval"),style:{textAlign:"center",maxWidth:"3rem"},body:e=>j(e,"Approval")})]})})]})})})]})}),a.jsx(je,{toast:C})]})})})};export{Fe as default};
