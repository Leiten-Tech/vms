import{a as A,r as n,u as M,b as R,p as F,c as D,dD as U,dE as h,j as l,d9 as L,n as O,C as V,d as q,dF as I,g as J,cw as T,cx as H,dG as B,B as k,dH as z,dI as $}from"./index-25a41ef1.js";import{P as G,A as Q}from"./PageHeader-b76b68bd.js";import"./column.esm-11a46c7b.js";import"./index.esm-9a713e1a.js";import"./inputswitch.esm-a89edc74.js";const re=()=>{const p=A(),s=n.useRef(null),d=M(),[P,W]=n.useState([]);n.useState();const[y,Y]=n.useState(),[c,w]=n.useState(),[S,u]=n.useState();n.useState(!1),n.useState(new Date),n.useState(new Date);const{loading:C,createEditData:K}=R(e=>e.visitor);n.useEffect(()=>{F()}),n.useEffect(()=>{m()},[]);const E=D({initialValues:{Remarks:""},onSubmit:(e,{resetForm:o})=>{}}),m=()=>{let e={PlantId:+localStorage.PlantId,UserId:+localStorage.UserId};var o=d(U(e));o.then(r=>{var a;r.payload.tranStatus.result==!0?W(r.payload.WorkPermitList):(a=s.current)==null||a.show({severity:"error",summary:"Error Message",detail:r.payload.tranStatus.lstErrorItem[0].Message})}).catch(r=>{var a;(a=s.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})},[g,X]=n.useState({pageTitle:"Work Permit",pageHeader:{pageActions:[{create:!0,clear:!1,save:!1,createQuery:"/home/cWorkPermit",createDispatch:()=>d(h({data:null,isView:!1,isCreate:!0}))}]},tableCheckSelection:!1,tableAction:!0,tableActionStyle:{minWidth:"14rem",maxWidth:"14rem",textAlign:"center",justifySelf:"center"},tableRows:10,tableRowsOptions:[5,10,25],tablePagination:!0,tableActions:[{title:"View",name:"view"},{title:"Edit",name:"edit"},{title:"Delete",name:"delete"},{title:"Approval",name:"approval"},{title:"Reject",name:"reject"}],tableColumns:[{title:"Work Permit Code",name:"WorkPermitCode",sort:!0,avatar:!1,badge:!1,colStyle:{minWidth:"6rem"}},{title:"Contractor Name",name:"ContractorName",sort:!0,avatar:!1,badge:!1,colStyle:{minWidth:"10rem"}},{title:"Work Permit Date",name:"WorkPermitDate",sort:!0,avatar:!1,badge:!1,colStyle:{}},{title:"Work Organizer",name:"WorkOrganizerId",sort:!0,avatar:!1,badge:!1,colStyle:{}},{title:"Valid From",name:"ValidFrom",sort:!0,avatar:!1,badge:!1,colStyle:{minWidth:"7rem"}},{title:"Valid To",name:"ValidTo",sort:!0,avatar:!1,badge:!1,colStyle:{}},{title:"Document Status",name:"DocStatusId",sort:!0,avatar:!1,badge:!0,colStyle:{minWidth:"7rem",textAlign:"center"}},{title:"Status Remarks",name:"StatusRemarks",sort:!0,avatar:!1,badge:!0,colStyle:{minWidth:"7rem",textAlign:"center"}},{title:"Status",name:"StatusName",sort:!0,avatar:!1,badge:!0,colStyle:{minWidth:"7rem",textAlign:"center"}}]}),x={view:e=>{const o={WorkPermitId:e.data.WorkPermitId,PlantId:+localStorage.PlantId,CompanyId:+localStorage.CompanyId};d(I(o)).then(a=>{var t;a.payload.tranStatus.result==!0?p.push("/home/cWorkPermit"):(t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:a.payload.tranStatus.lstErrorItem[0].Message})}).catch(a=>{var t;(t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})}),d(h(e))},edit:e=>{const o={WorkPermitId:e.data.WorkPermitId,PlantId:+localStorage.PlantId,CompanyId:+localStorage.CompanyId};d(I(o)).then(a=>{var t;a.payload.tranStatus.result==!0?p.push("/home/cWorkPermit"):(t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:a.payload.tranStatus.lstErrorItem[0].Message})}).catch(a=>{var t;(t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})}),d(h(e))},delete:e=>{J(`Are you sure you want to inactive this Work Permit (${e.data.ContractorName}[${e.data.WorkPermitCode}]) ?`,"Confirmation",()=>{const o={WorkPermitId:e.data.WorkPermitId};var r=d($(o));r.then(a=>{var t,i;a.payload.tranStatus.result==!0?((t=s.current)==null||t.show({severity:"success",summary:"Success Message",detail:"Inactivated Successfully."}),m()):(i=s.current)==null||i.show({severity:"error",summary:"Error Message",detail:a.payload.tranStatus.lstErrorItem[0].Message})}).catch(a=>{var t;(t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})})},()=>{})},print:e=>{localStorage.setItem("clickedRowData",JSON.stringify(e)),window.open("/home/print")},approval:e=>{let o={UserId:localStorage.UserId,WorkPermitCode:e.data.WorkPermitCode,WorkPermitDetailId:e.data.WorkPermitDetailId,Checkintime:new Date,type:"SelfApproval"};var r=d(T(o));r.then(a=>{var t,i;a.payload.tranStatus.result?((t=s.current)==null||t.show({severity:"success",summary:"Success Message",detail:"Checked In Successfully."}),m()):(i=s.current)==null||i.show({severity:"error",summary:"Error",detail:a.payload.tranStatus.lstErrorItem[0].Message})}).catch(a=>{var t;(t=s.current)==null||t.show({severity:"error",summary:"Error",detail:JSON.stringify(a)})})},approve:e=>{console.log(e),v(e)},reject:e=>{console.log(e),v(e)},checkOut:e=>{let o={UserId:localStorage.UserId,WorkPermitCode:e.data.WorkPermitCode,WorkPermitDetailId:e.data.WorkPermitDetailId,Checkouttime:new Date};var r=d(H(o));r.then(a=>{var t,i;a.payload.tranStatus.result?((t=s.current)==null||t.show({severity:"success",summary:"Success Message",detail:"Checked Out Successfully."}),m()):(i=s.current)==null||i.show({severity:"error",summary:"Error",detail:a.payload.tranStatus.lstErrorItem[0].Message})}).catch(a=>{var t;(t=s.current)==null||t.show({severity:"error",summary:"Error",detail:JSON.stringify(a)})})}},v=e=>{var r;if(console.log(e),!S){let a={UserId:+localStorage.UserId,PlantId:+localStorage.PlantId,RoleId:+localStorage.DefaultRoleId,Type:"PopupFetchWp",DocumentCode:(r=e==null?void 0:e.data)==null?void 0:r.WorkPermitCode};var o=d(B(a));o.then(t=>{var i;t.payload.tranStatus.result?t.payload.workflowpopups&&t.payload.workflowpopups.length>0&&(w(t.payload.workflowpopups[0]),u(!0)):((i=s.current)==null||i.show({severity:"error",detail:"Error",summary:t.payload.tranStatus.lstErrorItem[0].Message}),u(!1))}).catch(t=>{var i;(i=s.current)==null||i.show({severity:"error",detail:"Error",summary:JSON.stringify(t)})})}},b=e=>{let o={ApprovalRequest:{companyid:+localStorage.CompanyId,plantid:+localStorage.PlantId,requesterid:e.initiatedBy,documentno:e.DocumentNo,documentid:e.DocumentId,documentdetailid:null,remarks1:y,remarks2:y,status:75,approverid:+localStorage.UserId,levelid:e.LevelId,alternateuser:null,parentid:null,userid:+localStorage.UserId,requestfromdate:null,requesttodate:null,Isviewed:1}};f(o)},N=e=>{let o={ApprovalRequest:{companyid:+localStorage.CompanyId,plantid:+localStorage.PlantId,requesterid:e.initiatedBy,documentno:e.DocumentNo,documentid:e.DocumentId,documentdetailid:null,remarks1:y,remarks2:y,status:76,approverid:+localStorage.UserId,levelid:e.LevelId,alternateuser:null,parentid:null,userid:+localStorage.UserId,requestfromdate:null,requesttodate:null,Isviewed:1}};f(o)},f=e=>{var o=d(z(e));o.then(r=>{var a,t;r.payload.tranStatus.result?(m(),(a=s.current)==null||a.show({severity:"success",summary:"Success Message",detail:r.payload.tranStatus.lstErrorItem[0].Message}),u(!1)):((t=s.current)==null||t.show({severity:"error",summary:"Error Message",detail:r.payload.tranStatus.lstErrorItem[0].Message}),u(!1))}).catch(r=>{var a;(a=s.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})},j=l.jsxs("div",{children:[l.jsx(k,{label:"Approve",severity:"success",title:"Approve",icon:"las la-check",className:"mr-2 p-1",onClick:()=>b(c)}),l.jsx(k,{label:"Reject",severity:"danger",title:"Reject",icon:"las la-check",className:"mr-2 p-1",onClick:()=>N(c)})]});return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"page-container",children:l.jsxs("div",{className:"inner-page-container",children:[l.jsx(G,{pageTitle:g.pageTitle,pageConfig:g}),l.jsx("div",{className:"form-container scroll-y",children:l.jsx("div",{className:"white",children:l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"card",children:l.jsx(Q,{handleActions:x,data:P,loading:C,pageConfig:g})})})})})]})}),l.jsx(L,{header:"Approval For "+(c==null?void 0:c.FunctionName)+" ( "+(c==null?void 0:c.DocumentNo)+" ) ",visible:S,position:"bottom-right",style:{width:"50vw"},onHide:()=>u(!1),footer:j,draggable:!1,resizable:!1,children:l.jsx(O,{type:"textarea",name:"Remarks",label:"Remarks",options:"",show:!0,required:!1,disable:!1,optionLabel:"",optionValue:"",handleSelect:"",maxlength:"500",formik:E,style:{maxHeight:"100px",overflowY:"auto"}})}),l.jsx(V,{}),l.jsx(q,{toast:s})]})};export{re as default};
