import{a as se,u as ie,r as l,b5 as oe,L as ne,b as ue,p as de,c as ce,t as N,b7 as me,b8 as ye,j as t,F as ge,B as x,n as g,A as pe,d as Me,b9 as he,ba as fe,bb as Se}from"./index-25a41ef1.js";import{M as be}from"./Master-b11b8a2f.js";import"./index.esm-21a4a4d3.js";const Oe=()=>{const I=se(),p=ie(),M=l.useRef(null),n=l.useRef(null),[V,d]=l.useState(!1),[Ce,U]=l.useState();l.useEffect(()=>{a==null&&p(oe({MaterialId:0}))},[]),l.useState([]);const[O,q]=l.useState([]),[D,P]=l.useState([]),[k,R]=l.useState([]),[Ne,A]=l.useState([]),[J,W]=l.useState(null),[w,G]=l.useState(),[xe,H]=l.useState(ne.NO_IMG),{isCreate:h,isView:u,createEditData:Ie,loading:_,error:we,CountryStatus:je,MaterialList:Te,Country:ve,HdrTable:a,MaterialCategoryList:S,MaterialSubCategoryList:b,MaterialTypeList:C,StatusList:$,OnChangeBrand:j,UomList:z,NumberingSchema:Ee,reload:Le,createOrEdit:Be,transtatus:T}=ue(e=>e.material);l.useEffect(()=>{de()}),l.useEffect(()=>{T!=null&&M.current&&M.current.focus()},[T]),l.useEffect(()=>{a!=null&&K(a.ImageUrl).then(e=>{const r=new File([e],a.ImageName,{type:"image/*",lastModified:1695716506050});W(r),G(a.ImageName),H(a.MaterialImageUrl)}).catch(e=>{})},[]);async function K(e){const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch image: ${r.statusText}`);return await r.blob()}const Q=e=>{const r=C.find(o=>o.MaterialTypeId===e);return r?r.MaterialTypeName:""},X=e=>{const r=S.find(o=>o.MaterialCategoryId===e);return r?r.MaterialCategoryName:""},Y=e=>{const r=b.find(o=>o.MaterialSubCategoryId===e);return r?r.MaterialSubCategoryName:""},s=ce({initialValues:{MaterialType:a!=null?Q(a.MaterialType):0,MaterialCategory:a!=null?X(a.MaterialCategoryId):"",MaterialSubCategory:a!=null?Y(a.MaterialSubCategoryId):"",MaterialName:a!=null?a.MaterialName:"",BrandName:a!=null?a.BrandName:"",Uom:a!=null?a.Uom:null,Status:a!=null?a.Status:1},validationSchema:be,onSubmit:async(e,{resetForm:r})=>{var v,E,L,B,F;for(d(!0);s.isValidating;)await new Promise(y=>setTimeout(y,100));if(!e.MaterialType){(v=n.current)==null||v.show({severity:"warn",summary:"Warning Message",detail:"Please Enter Material Type"}),d(!1);return}if(!e.MaterialCategory){(E=n.current)==null||E.show({severity:"warn",summary:"Warning Message",detail:"Please Enter Material Category"}),d(!1);return}if(!e.MaterialSubCategory){(L=n.current)==null||L.show({severity:"warn",summary:"Warning Message",detail:"Please Enter Material Sub Category"}),d(!1);return}const o=new FormData;let re={Material:{MaterialId:a!=null?a.MaterialId:0,MaterialCode:a!=null?a.MaterialCode:"",MaterialType:a!=null?a.MaterialType:0,MaterialCategoryId:a!=null?a.MaterialCategoryId:0,MaterialSubCategoryId:a!=null?a.MaterialSubCategoryId:0,MaterialName:e.MaterialName,BrandName:e.BrandName,Uom:e.Uom,PurchasePrice:2,MaterialImageName:w,MaterialImageUrl:w,Status:e.Status,CreatedBy:a!=null?a.CreatedBy:localStorage.UserId,CreatedOn:a!=null?N(a.CreatedOn):N(new Date),ModifiedBy:a!=null?localStorage.UserId:null,ModifiedOn:a!=null?N(new Date):null},MaterialTypeName:typeof e.MaterialType=="object"?e.MaterialType.MaterialTypeName:e.MaterialType,MaterialCategoryName:typeof e.MaterialCategory=="object"?e.MaterialCategory.MaterialCategoryName:e.MaterialCategory,MaterialSubCategoryName:typeof e.MaterialSubCategory=="object"?e.MaterialSubCategory.MaterialSubCategoryName:e.MaterialSubCategory},le=JSON.stringify(re);if(o.append("input",le),o.append("webfile",J),a!=null){if(a.isCreate!=!1)try{p(me(o)).then(i=>{var m,f;(i.payload!=null||!i.payload)&&(i.payload.transtatus.result==!0?((m=n.current)==null||m.show({severity:"success",summary:"Success Message",detail:i.payload.transtatus.lstErrorItem[0].Message}),r(),setTimeout(()=>{I.push("/home/vMaterial")},800)):i.payload.transtatus.result==!1&&((f=n.current)==null||f.show({severity:"error",summary:"Error Message",detail:i.payload.transtatus.lstErrorItem[0].Message}),d(!1)))})}catch(y){(B=n.current)==null||B.show({severity:"warn",summary:"Error Message",detail:y})}}else try{p(ye(o)).then(i=>{var m,f;d(!0),(i.payload!=null||!i.payload)&&(i.payload.transtatus.result==!0?(d(!1),(m=n.current)==null||m.show({severity:"success",summary:"Success Message",detail:i.payload.transtatus.lstErrorItem[0].Message}),r()):i.payload.transtatus.result==!1&&(d(!1),(f=n.current)==null||f.show({severity:"warn",summary:"Error Message",detail:i.payload.transtatus.lstErrorItem[0].Message})))}).catch(i=>{var m;(m=n.current)==null||m.show({severity:"warn",summary:"Error Message",detail:JSON.stringify(i.payload)})})}catch(y){(F=n.current)==null||F.show({severity:"warn",summary:"Error Message",detail:JSON.stringify(y.payload)})}}}),Z=()=>{s.resetForm()},c=(e,r,o)=>{s.setFieldValue(e,o)},ee=e=>{let r={MaterialTypeName:e.query};p(he(r))},ae=e=>{let r={MaterialCategoryName:e.query};p(fe(r))},te=e=>{let r={MaterialSubCategoryName:e.query};p(Se(r))};return l.useEffect(()=>{q(C)},[C]),l.useEffect(()=>{P(S)},[S]),l.useEffect(()=>{R(b)},[b]),l.useEffect(()=>{A(j)},[j]),t.jsxs(t.Fragment,{children:[t.jsx(ge,{initialValues:s.initialValues,validationSchema:s.validationSchema,onSubmit:s.handleSubmit,children:t.jsx("div",{className:"page-container",children:t.jsxs("div",{className:"inner-page-container",children:[t.jsx("div",{className:"page-title",children:t.jsxs("div",{className:"grid grid-nogutter",children:[t.jsx("div",{className:"md:col-6",children:t.jsx("h1",{children:"Material"})}),t.jsx("div",{className:"md:col-6 text-right",children:t.jsxs("div",{className:"action-btn",children:[t.jsxs(t.Fragment,{children:[t.jsx(x,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",type:"submit",disabled:!!(u||V),onClick:()=>s.handleSubmit()}),t.jsx(x,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:!!(u||h==!1),onClick:()=>Z()})]}),t.jsx(x,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{I.push("/home/vMaterial")}})]})})]})}),t.jsx("div",{className:"form-container scroll-y",children:t.jsx("form",{children:t.jsx("div",{className:"white",children:t.jsx("div",{className:"widget-body",children:t.jsx("div",{className:"normal-table",children:t.jsx("div",{className:"grid",children:_?t.jsx(pe,{}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"col-12 md:col-12",children:t.jsxs("div",{className:"grid",children:[t.jsx(g,{type:"autocomplete",name:"MaterialType",label:"Material Type",show:!0,required:!0,disable:u||!h,optionLabel:"",optionValue:"",handleChange:e=>{c("MaterialType",s.values.MaterialType,e.target.value),U(e.target.value.MaterialTypeId)},fldStyle:"col-12 md:col-3",formik:s,autoSearch:ee,autoCompleteRef:M,autoSuggestions:O,autoCompleteLbl:"MaterialTypeName",field:"MaterialTypeId",maxLength:100}),t.jsx(g,{type:"autocomplete",name:"MaterialCategory",label:"Material Category",options:"",show:!0,required:!0,disable:u||!h,fldStyle:"col-12 md:col-3",optionLabel:"",optionValue:"",handleSelect:c,handleChange:e=>{c("MaterialCategory",s.values.MaterialCategory,e.target.value)},formik:s,autoSearch:ae,autoCompleteRef:M,autoSuggestions:D,autoCompleteLbl:"MaterialCategoryName",field:"MaterialCategoryId",maxLength:100}),t.jsx(g,{type:"autocomplete",name:"MaterialSubCategory",label:"Material Sub Category",options:"",show:!0,required:!0,disable:u||!h,optionLabel:"",fldStyle:"col-12 md:col-3",optionValue:"",handleChange:e=>{c("MaterialSubCategory",s.values.MaterialSubCategory,e.target.value)},formik:s,autoSearch:te,autoCompleteRef:M,autoSuggestions:k,autoCompleteLbl:"MaterialSubCategoryName",field:"MaterialSubCategoryId",maxLength:100}),t.jsx(g,{type:"autocomplete",name:"MaterialName",label:"Material Name",options:"",show:!0,required:!0,disable:!!u,optionLabel:"",fldStyle:"col-12 md:col-3",optionValue:"",handleSelect:c,handleChange:e=>{c("MaterialName",s.values.MaterialName,e.target.value)},formik:s,maxLength:100}),t.jsx(g,{type:"text",name:"BrandName",label:"Brand Name",options:"",show:!0,required:!1,disable:!!u,optionLabel:"",optionValue:"",handleSelect:"",formik:s,fldStyle:"col-12 md:col-3",maxlength:"100"}),t.jsx(g,{type:"select",name:"Uom",label:"UOM",options:z,show:!0,required:!0,disable:!!u,optionValue:"MetaSubId",optionLabel:"MetaSubDescription",fldStyle:"col-12 md:col-3",handleSelect:c,formik:s}),t.jsx(g,{type:"select",name:"Status",label:"Status",options:$,show:!0,required:!0,disable:!!(u||h),optionLabel:"MetaSubDescription",fldStyle:"col-12 md:col-3",optionValue:"MetaSubId",handleSelect:c,formik:s})]})})})})})})})})})]})})}),t.jsx(Me,{toast:n})]})};export{Oe as default};
