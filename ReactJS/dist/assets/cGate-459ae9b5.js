import{u as ee,r as f,a as te,b as ae,p as le,as as se,t as U,c as K,j as e,B as G,A as re,au as ie,F as Z,n as c,av as oe,aw as ne,ax as de}from"./index-25a41ef1.js";import{D as me,C as P}from"./column.esm-11a46c7b.js";import{G as z,e as ue}from"./Master-b11b8a2f.js";import"./index.esm-9a713e1a.js";import"./index.esm-21a4a4d3.js";const ce=(h,m,s,p)=>{const b=()=>{s([]),s(m.filter(w=>w!=h))};return e.jsx(G,{label:"",severity:"danger",title:"Delete",icon:"las la-trash",className:"mr-2 p-1",disabled:!!p,onClick:()=>b()})},he=h=>{const{isCreate:m,isView:s,createEditData:p,loading:b,error:w,StatusList:A,HdrTable:W,EmployeeList:D,CompanyList:T,formik:o,handleSelect:n,handleCompanySelect:j,OnChangeCompanyList:F,gateForm:x,gateRef:v,onSubmit:L,plantList:a,handleOnChange:E}=h;return e.jsx(Z,{initialValues:x,validationSchema:z,onSubmit:o.handleSubmit,children:e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsxs("div",{className:"grid",children:[e.jsx(c,{type:"text",name:"GateCode",label:"Gate Code",options:"",show:!1,required:!0,disable:!!(s||m==!1),optionLabel:"",optionValue:"",handleSelect:"",formik:o,fldStyle:"col-12 md:col-3",onKeyPress:()=>{}}),e.jsx(c,{type:"text",name:"GateName",label:"Gate Name",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",formik:o,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"text",name:"GateNo",label:"Gate No",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",handleSelect:"",formik:o,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"select",name:"GateInchargeId",label:"Gate Incharge Name",options:D,show:!0,required:!0,disable:!!s,optionLabel:"UserName",optionValue:"UserId",handleSelect:n,formik:o,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"select",name:"CompanyId",label:"Company Name",options:T,show:!0,required:!0,disable:!!s,optionLabel:"CompanyName",optionValue:"CompanyId",handleSelect:j,formik:o,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"select",name:"PlantId",label:"Plant Name",options:a,show:!0,required:!0,disable:!!s,optionLabel:"PlantName",optionValue:"PlantId",handleSelect:n,formik:o,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"Calendar",name:"GateOpenTime",label:"Gate Open Time",options:"",show:!0,required:!0,disable:!!s,optionLabel:"",optionValue:"",formik:o,handleChange:E,fldStyle:"col-12 md:col-3",timeOnly:!0,showTime:!0,hourFormat:"12"}),e.jsx(c,{type:"Calendar",name:"GateCloseTime",label:"Gate Close Time",options:"",show:!0,required:!0,optionLabel:"",optionValue:"",formik:o,handleChange:E,fldStyle:"col-12 md:col-3",timeOnly:!0,showTime:!0,hourFormat:"12",disable:!!s}),e.jsx(c,{type:"select",name:"Status",label:"Status",options:A,show:!0,required:!0,disable:!!s||m==null||m==!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:n,formik:o,fldStyle:"col-12 md:col-3"})]})})})})})},pe=h=>{const{isCreate:m,isView:s,createEditData:p,loading:b,error:w,StatusList:A,HdrTable:W,EmployeeList:D,CompanyList:T,PlantList:o,formik:n,handleSelect:j,handleSecuritySelect:F,gateDetailList:x,filters:v,TableHeader:L,OnAdd:a,gateDetailForm:E,gateDetailRef:R,OnClear:O,onRowSelect:k,setGateDetailList:N,SecurityList:I}=h;return e.jsx(Z,{initialValues:n.gateDetailForm,validationSchema:n.GateDetailValidationSchema,onSubmit:n.handleSubmit,children:e.jsx("div",{className:"white",children:e.jsxs("div",{className:"widget-body",children:[e.jsxs("div",{className:"normal-table",children:[e.jsx("div",{className:"page-title",children:e.jsx("div",{className:"grid grid-nogutter",children:e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Security Details"})})})}),e.jsxs("div",{className:"grid",children:[e.jsx(c,{type:"select",name:"SecurityId",label:"Security Name",options:I,show:!0,required:!0,disable:!!s,optionLabel:"UserName",optionValue:"UserId",handleSelect:F,formik:n,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"text",name:"Email",label:"Email",options:"",show:!0,required:!0,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",formik:n,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"text",name:"PhoneNumber",label:"Phone Number",options:"",show:!0,required:!0,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",formik:n,fldStyle:"col-12 md:col-3"}),e.jsx(c,{type:"textarea",name:"Address",label:"Address",options:"",show:!0,required:!0,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",formik:n,fldStyle:"col-12 md:col-3"})]}),e.jsxs("div",{className:"text-center mb-3",children:[e.jsx(G,{label:"Add",severity:"success",icon:"las la-plus",title:"Add",className:"text-center",onClick:n.handleSubmit,type:"submit",disabled:!!s}),e.jsx(G,{label:"Delete",severity:"danger",icon:"las la-trash",title:"Delete",className:"text-center",onClick:()=>O(),disabled:!!s})]})]}),e.jsx("div",{className:"card",children:e.jsxs(me,{value:x,showGridlines:!0,paginator:!0,filters:v,filterDisplay:"menu",globalFilterFields:["FirstName","PhoneNumber","Email","Address"],header:L,emptyMessage:"No Data Found.",rows:5,rowsPerPageOptions:[5,10,25,50],tableStyle:{minWidth:"50rem"},children:[e.jsx(P,{header:"Action",style:{textAlign:"center",minWidth:"5em",maxWidth:"5em",overflowWrap:"break-word"},body:M=>ce(M,x,N,s),headerClassName:"text-center"}),e.jsx(P,{field:"FirstName",header:"Security Name",style:{minWidth:"20em",maxWidth:"20em",overflowWrap:"break-word"},headerClassName:"text-center"}),e.jsx(P,{field:"PhoneNumber",header:"Phone Number",style:{minWidth:"20em",maxWidth:"20em",overflowWrap:"break-word"},headerClassName:"text-center"}),e.jsx(P,{field:"Email",header:"Mail ID",style:{minWidth:"20em",maxWidth:"20em",overflowWrap:"break-word"},headerClassName:"text-center"}),e.jsx(P,{field:"Address",header:"Address",style:{minWidth:"30em",maxWidth:"30em",overflowWrap:"break-word"},headerClassName:"text-center"})]})})]})})})},xe=()=>{const h=ee(),m=f.useRef(null),s=te(),[p,b]=f.useState([]),w=f.useRef(),A=f.useRef(),[W,D]=f.useState([]),[T,o]=f.useState(!1),{isCreate:n,isView:j,createEditData:F,loading:x,error:v,StatusList:L,HdrTable:a,EmployeeList:E,CompanyList:R,PlantList:O,OnChangeCompanyList:k,GateDetailList:N,SecurityList:I}=ae(t=>t.gate);f.useEffect(()=>{le()}),f.useEffect(()=>{if(n==!1){let t=[];if(N&&N.length&&N.length>0)for(let y=0;y<N.length;y++){const l=N[y];let d={};d.GateDetailId=0,d.GateId=l.GateId??0,d.SecurityId=l.SecurityId,d.Email=l.Email,d.PhoneNumber=l.PhoneNumber,d.Address=l.Address,d.FirstName=I.find(S=>S.UserId==l.SecurityId).UserName,t.push(d)}b(t)}else{const t={GateId:0,Taskname:"CREATEINITIALIZE",PlantId:localStorage.PlantId};h(se(t)),u.setFieldValue("GateOpenTime",null),u.setFieldValue("GateCloseTime",null)}},[]),f.useEffect(()=>{D(k)},[k]);const M={GateId:a!=null?a.GateId:0,GateName:a!=null?a.GateName:"",GateCode:a!=null?a.GateCode:"",GateNo:a!=null?a.GateNo:"",GateInchargeId:a!=null?a.GateInchargeId:null,GateOpenTime:a!=null?new Date(a.GateOpenTime):null,GateCloseTime:a!=null?new Date(a.GateCloseTime):null,CompanyId:a!=null?a.CompanyId:null,PlantId:a!=null?a.PlantId:null,Status:a!=null?a.Status:1,CreatedBy:a!=null?a.CreatedBy:localStorage.UserId,CreatedOn:a!=null?U(a.CreatedOn):U(new Date),ModifiedBy:a!=null?localStorage.UserId:null,ModifiedOn:a!=null?U(new Date):null},q={GateDetailId:0,GateId:0,SecurityId:null,Email:"",PhoneNumber:"",Address:""},u=K({initialValues:M,validationSchema:z,onSubmit:(t,{resetForm:y})=>{var S;o(!0);let l=[];for(let g=0;g<p.length;g++){const r=p[g];let i={};i.GateDetailId=0,i.GateId=0,i.SecurityId=r.SecurityId,i.Email=r.Email,i.PhoneNumber=r.PhoneNumber,i.Address=r.Address,l.push(i)}if(!l||!l.length||l.length==0){o(!1),(S=m.current)==null||S.show({severity:"warn",summary:"Warn Message",detail:"Please Add Atleast One Security Details"});return}t.GateOpenTime=new Date(t.GateOpenTime).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),t.GateCloseTime=new Date(t.GateCloseTime).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});let d={Gate:t,GateDetail:l};n==!1?h(oe(d)).then(r=>{var i,V;(r.payload!=null||!r.payload)&&(r.payload.transtatus.result==!0?(o(!1),(i=m.current)==null||i.show({severity:"success",summary:"Success Message",detail:r.payload.transtatus.lstErrorItem[0].Message}),setTimeout(()=>{s.push("/home/vGate")},800)):(o(!1),(V=m.current)==null||V.show({severity:"error",summary:"Error Message",detail:r.payload.transtatus.lstErrorItem[0].Message})))}).catch(r=>{var i;(i=m.current)==null||i.show({severity:"error",summary:"Error Message",detail:r})}):h(ne(d)).then(r=>{var i,V;r.payload.transtatus.result==!0?(o(!1),(i=m.current)==null||i.show({severity:"success",summary:"Success Message",detail:r.payload.transtatus.lstErrorItem[0].Message}),J()):r.payload.transtatus.result==!1&&(o(!1),(V=m.current)==null||V.show({severity:"error",summary:"Error Message",detail:r.payload.transtatus.lstErrorItem[0].Message}))}).catch(r=>{var i;(i=m.current)==null||i.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})}}),C=K({initialValues:q,validationSchema:ue,onSubmit:(t,{resetForm:y})=>{var S;let l={};if(l.GateDetailId=0,l.SecurityId=t.SecurityId,l.FirstName=I.find(g=>g.UserId==t.SecurityId).UserName,l.Email=t.Email,l.PhoneNumber=t.PhoneNumber,l.Address=t.Address,(p.filter(g=>g.FirstName==l.FirstName)||[]).length>0&&l.GateDetailId==0){(S=m.current)==null||S.show({severity:"warn",summary:"Warning Message",detail:"Security Already Exists"});return}b([...p,l]),H()}}),B=(t,y,l)=>{u.setFieldValue(t,l)},Q=t=>{u.setFieldValue(t.target.name,t.value)},X=(t,y,l)=>{u.setFieldValue("PlantId",null),u.setFieldValue(t,l),h(de({CompanyId:l}))},Y=(t,y,l)=>{C.setFieldValue(t,l);let d=I.find(S=>S.UserId==l);C.setFieldValue("Email",d.UserEmail),C.setFieldValue("PhoneNumber",d.UserTelNo),C.setFieldValue("Address",d.Address)},_=()=>{let t={};t.GateDetailId=0,t.SecurityId=u.values.gateDetailForm.SecurityId,t.FirstName=I.find(y=>y.EmployeeId==u.values.gateDetailForm.SecurityId).FirstName,t.Email=u.values.gateDetailForm.Email,t.PhoneNumber=u.values.gateDetailForm.PhoneNumber,t.Address=u.values.gateDetailForm.Address,b([...p,t])},H=()=>{C.resetForm()},$=t=>{},J=()=>{u.resetForm(),C.resetForm(),b([]),D([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsxs("div",{className:"grid grid-nogutter",children:[e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Gate"})}),e.jsx("div",{className:"md:col-6 text-right",children:e.jsxs("div",{className:"action-btn",children:[e.jsxs(e.Fragment,{children:[e.jsx(G,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",type:"submit",disabled:!!(j||T),onClick:()=>u.handleSubmit()}),e.jsx(G,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:!!(j||n==!1),onClick:()=>J()})]}),e.jsx(G,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{s.push("/home/vGate")}})]})})]})}),x?e.jsx(re,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-container scroll-y",children:[e.jsx(he,{isCreate:n,isView:j,createEditData:F,loading:x,error:v,StatusList:L,HdrTable:a,EmployeeList:E,CompanyList:R,PlantList:O,formik:u,handleSelect:B,handleOnChange:Q,handleCompanySelect:X,OnChangeCompanyList:k,gateForm:M,gateRef:w,plantList:W}),e.jsx(pe,{handleSecuritySelect:Y,SecurityList:I,isCreate:n,isView:j,createEditData:F,loading:x,error:v,StatusList:L,HdrTable:a,CompanyList:R,PlantList:O,formik:C,handleSelect:B,OnAdd:_,gateDetailList:p,gateDetailForm:q,gateDetailRef:A,OnClear:H,onRowSelect:$,setGateDetailList:b,GateDetailList:N})]})})]})}),e.jsx(ie,{ref:m})]})};export{xe as default};
