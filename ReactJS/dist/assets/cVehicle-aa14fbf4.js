import{u as xe,r as S,a as be,b as Ne,p as Ve,ch as De,t as G,c as te,j as e,B as g,A as ge,au as je,F as le,n as u,cj as ve,ck as Ce,cl as Le}from"./index-25a41ef1.js";import{F as we}from"./fileupload.esm-b904f07b.js";import{D as Fe,C as U}from"./column.esm-11a46c7b.js";import{l as ae,m as Ie}from"./Master-b11b8a2f.js";import"./index.esm-9a713e1a.js";import"./index.esm-21a4a4d3.js";const Ae=(h,o,i,F)=>{const I=()=>{i([]),i(o.filter(b=>b!=h))};return e.jsx(g,{label:"",severity:"danger",title:"Delete",icon:"las la-trash",className:"mr-2 p-1",disabled:!!F,onClick:()=>I()})},ke=h=>e.jsx("a",{style:{color:"blue"},href:h.AttachmentUrl,target:"_blank",children:h.AttachmentName}),se=h=>{const{isCreate:o,isView:i,createEditData:F,loading:I,error:b,StatusList:j,HdrTable:T,EmployeeList:B,CompanyList:q,OnChangeCompanyList:A,plantList:p,VehicleMasterList:M,VehicleTypeList:x,SupplierList:k,PlantList:P,VehicleList:f,formik:c,handleSelect:N,handleCompanySelect:v,handleSupplierSelect:E,DisableSupplier:C,handleVehicleSelect:V,onSubmit:O}=h;return e.jsx(le,{initialValues:se,validationSchema:ae,onSubmit:O,children:e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsxs("div",{className:"grid",children:[e.jsx(u,{type:"text",name:"VehicleCode",label:"Vehicle Code",options:"",show:!1,required:!0,disable:!!(i||o==!1),optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-3",onKeyPress:()=>{}}),e.jsx(u,{type:"select",name:"VehicleType",label:"Vehicle Type",options:x,show:!0,required:!0,disable:!!i,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:V,formik:c,fldStyle:"col-12 md:col-3"}),e.jsx(u,{type:"text",name:"VehicleName",label:"Vehicle Name",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-3"}),e.jsx(u,{type:"text",name:"VehicleNo",label:"Vehicle No",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-3"}),e.jsx(u,{type:"text",name:"VehicleModel",label:"Vehicle Model",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-3"}),e.jsx("div",{className:"col-12 md:col-9",children:e.jsxs("div",{className:"grid",children:[e.jsx(u,{type:"select",name:"SupplierId",label:"Supplier Name",options:k,show:!0,required:!1,disable:!!(C||i),optionLabel:"SupplierName",optionValue:"SupplierId",handleSelect:E,formik:c,fldStyle:"col-12 md:col-4"}),e.jsx(u,{type:"text",name:"SupplierMobileNo",label:"Supplier Mobile No",options:"",show:!0,required:!1,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-4"}),e.jsx(u,{type:"text",name:"SupplierAddress",label:"Supplier Address",options:"",show:!0,required:!1,disable:!0,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-4"}),e.jsx(u,{type:"Calendar",name:"VehicleFcDate",label:"Last Vehicle FC Date",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",formik:c,handleChange:c.handleChange,fldStyle:"col-12 md:col-4"}),e.jsx(u,{type:"Calendar",name:"ServiceDate",label:"Next Service Date",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",formik:c,handleChange:c.handleChange,fldStyle:"col-12 md:col-4"}),e.jsx(u,{type:"select",name:"Status",label:"Status",options:j,show:!0,required:!0,disable:!!i||o==null||o==!0,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:N,formik:c,fldStyle:"col-12 md:col-4"})]})}),e.jsx(u,{type:"textarea",name:"Remarks",label:"Remarks",options:"",show:!0,required:!1,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:c,fldStyle:"col-12 md:col-3",maxlength:"500",style:{maxHeight:"100px",overflowY:"auto"}})]})})})})})},Ee=h=>{const{isCreate:o,isView:i,createEditData:F,loading:I,error:b,StatusList:j,HdrTable:T,EmployeeList:B,VehicleMasterList:q,VehicleTypeList:A,formik:p,OnClear:M,vehicleDetailList:x,filters:k,TableHeader:P,AttachmentUrl:f,onUploadDocument:c,setVehicleDetailList:N,ClearFileUpload:v,handleClick:E}=h,C={icon:"las la-upload",iconOnly:!0};return e.jsx(le,{initialValues:p.vehicleDetailForm,validationSchema:p.VehicleDetailValidationSchema,onSubmit:p.handleSubmit,children:e.jsx("div",{className:"white",children:e.jsxs("div",{className:"widget-body",children:[e.jsxs("div",{className:"normal-table",children:[e.jsx("div",{className:"page-title",children:e.jsx("div",{className:"grid grid-nogutter",children:e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Document Details"})})})}),e.jsxs("div",{className:"grid",children:[e.jsx(u,{type:"text",name:"DocumentName",label:"Document Name",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:p,fldStyle:"col-12 md:col-3"}),e.jsx(u,{type:"text",name:"DocumentNo",label:"Document No",options:"",show:!0,required:!0,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:p,fldStyle:"col-12 md:col-3"}),e.jsxs("div",{className:"col-12 md:col-3",children:[e.jsxs("label",{className:"form-label",children:["Document Upload",e.jsx("span",{className:"hlt-txt",children:"*"})]}),e.jsxs("div",{className:"p-inputgroup",children:[e.jsx("div",{className:"browse-links",children:e.jsx(g,{label:p.values.AttachmentName,link:!0,onClick:()=>E(f)})}),e.jsx(we,{mode:"basic",chooseOptions:C,onSelect:c,chooseLabel:f,auto:!0,accept:".jpeg, .jpg, .png, .pdf, .word, .xls, .xlsx",disabled:!!i}),e.jsx(g,{icon:"las la-times",disabled:!!i,onClick:v})]})]}),e.jsx(u,{type:"textarea",name:"Remarks",label:"Remarks",options:"",show:!0,required:!1,disable:!!i,optionLabel:"",optionValue:"",handleSelect:"",formik:p,fldStyle:"col-12 md:col-3",maxlength:"500",style:{maxHeight:"100px",overflowY:"auto"}})]}),e.jsxs("div",{className:"text-center mb-3",children:[e.jsx(g,{label:"Add",severity:"success",icon:"las la-plus",title:"Add",className:"text-center",onClick:p.handleSubmit,type:"submit",disabled:!!i}),e.jsx(g,{label:"Delete",severity:"danger",icon:"las la-trash",title:"Delete",className:"text-center",onClick:()=>M(),disabled:!!i})]})]}),e.jsx("div",{className:"card",children:e.jsxs(Fe,{value:x,showGridlines:!0,paginator:!0,filters:k,filterDisplay:"menu",globalFilterFields:["DocumentName","DocumentNo","AttachmentName","AttachmentUrl","Remarks"],header:P,emptyMessage:"No Data Found.",rows:5,rowsPerPageOptions:[5,10,25,50],tableStyle:{minWidth:"50rem"},children:[e.jsx(U,{header:"Action",style:{textAlign:"center",minWidth:"5em",maxWidth:"5em"},body:V=>Ae(V,x,N,i),headerClassName:"text-center"}),e.jsx(U,{field:"DocumentName",style:{minWidth:"20em",maxWidth:"20em",overflowWrap:"break-word"},header:"Document Name",headerClassName:"text-center"}),e.jsx(U,{field:"DocumentNo",header:"Document Number",headerClassName:"text-center"}),e.jsx(U,{header:"Document URL",style:{minWidth:"20em",maxWidth:"20em",overflowWrap:"break-word"},body:V=>ke(V),headerClassName:"text-center"}),e.jsx(U,{field:"Remarks",style:{minWidth:"30em",maxWidth:"30em",overflowWrap:"break-word"},header:"Remarks",headerClassName:"text-center"})]})})]})})})},He=()=>{const h=xe(),o=S.useRef(null),i=be(),[F,I]=S.useState(!0),[b,j]=S.useState([]),[T,B]=S.useState([]),[q,A]=S.useState(""),[p,M]=S.useState(null),[x,k]=S.useState([]);S.useState(null);const[P,f]=S.useState(!1),c=S.useRef(),{isCreate:N,isView:v,createEditData:E,loading:C,error:V,StatusList:O,HdrTable:t,EmployeeList:ie,CompanyList:J,PlantList:X,OnChangeCompanyList:re,VehicleMasterList:Me,VehicleTypeList:oe,SupplierList:W,VehicleList:Re,VehicleDetailList:Y}=Ne(l=>l.vehicle);S.useEffect(()=>{Ve()}),S.useEffect(()=>{if(N==!1){let l=[];for(let d=0;d<Y.length;d++){const a=Y[d];let s={};s.VehicleDocumentDetailId=0,s.VehicleId=a.VehicleId??0,s.DocumentName=a.DocumentName,s.DocumentNo=a.DocumentNo,s.AttachmentUrl=a.AttachmentUrl,s.AttachmentName=a.AttachmentName,s.Remarks=a.Remarks,l.push(s)}j(l),t.VehicleType===29&&I(!1)}else h(De({VehicleId:0,Taskname:"CREATEINITIALIZE"}))},[]);const ne=l=>W.filter(a=>a.SupplierId==t.SupplierId&&a.Status==1).length!=0,ce={VehicleId:t!=null?t.VehicleId:0,VehicleCode:t!=null?t.VehicleCode:"",VehicleName:t!=null?t.VehicleName:"",CompanyId:t!=null?t.CompanyId:localStorage.CompanyId,PlantId:t!=null?t.PlantId:localStorage.PlantId,VehicleType:t!=null?t.VehicleType:28,VehicleNo:t!=null?t.VehicleNo:"",SupplierId:t!=null&&ne(t.SupplierId)?t.SupplierId:null,SupplierMobileNo:t!=null?t.SupplierMobileNo:"",SupplierAddress:t!=null?t.SupplierAddress:"",VehicleModel:t!=null?t.VehicleModel:"",EmployeeId:t!=null?t.EmployeeId:null,VehicleFcDate:t!=null?new Date(t.VehicleFcDate):"",ServiceDate:t!=null?new Date(t.ServiceDate):"",Remarks:t!=null?t.Remarks:"",Status:t!=null?t.Status:1,CreatedBy:t!=null?t.CreatedBy:localStorage.UserId,CreatedOn:t!=null?G(t.CreatedOn):G(new Date),ModifiedBy:t!=null?localStorage.UserId:null,ModifiedOn:t!=null?G(new Date):null},_={VehicleDocumentDetailId:0,VehicleId:0,DocumentName:"",DocumentNo:"",AttachmentUrl:"",AttachmentName:"",Remarks:""},y=te({initialValues:ce,validationSchema:ae,onSubmit:(l,{resetForm:d})=>{var Q,$;if(f(!0),l.VehicleType==29&&!l.SupplierId){(Q=o.current)==null||Q.show({severity:"error",summary:"Error Message",detail:"Please Select Supplier Name"}),f(!1);return}const a=new FormData;let s=[];for(let w=0;w<b.length;w++){const r=b[w];let n={};n.VehicleDocumentDetailId=0,n.VehicleId=0,n.DocumentName=r.DocumentName,n.DocumentNo=r.DocumentNo,n.AttachmentUrl=r.AttachmentUrl,n.AttachmentName=r.AttachmentName,n.Remarks=r.Remarks,s.push(n)}if(!s||!s.length||s.length==0){($=o.current)==null||$.show({severity:"error",summary:"Error Message",detail:"Please Add AtLeast One Document Detail."}),f(!1);return}let m=JSON.stringify({Vehicle:l,VehicleDocumentDetail:s});a.append("input",m);for(var z in x){var Se=s.findIndex(w=>w.AttachmentName==x[z].name);Se!=-1&&a.append("webfiles",x[z])}N==!1?h(ve(a)).then(r=>{var n,R,ee;if(f(!1),r.payload!=null||!r.payload)if(r.payload.transtatus.result==!0){if(f(!1),r.payload.VehicleType==29&&!r.payload.SupplierId){(n=o.current)==null||n.show({severity:"error",summary:"Error Message",detail:"Please Select Supplier Name"});return}(R=o.current)==null||R.show({severity:"success",summary:"Success Message",detail:r.payload.transtatus.lstErrorItem[0].Message}),setTimeout(()=>{i.push("/home/vVehicle")},800)}else f(!1),(ee=o.current)==null||ee.show({severity:"error",summary:"Error Message",detail:r.payload.transtatus.lstErrorItem[0].Message})}).catch(r=>{var n;(n=o.current)==null||n.show({severity:"error",summary:"Error Message",detail:r})}):h(Ce(a)).then(r=>{var n,R;r.payload.transtatus.result==!0?(f(!1),(n=o.current)==null||n.show({severity:"success",summary:"Success Message",detail:r.payload.transtatus.lstErrorItem[0].Message}),Z()):r.payload.transtatus.result==!1&&(f(!1),(R=o.current)==null||R.show({severity:"error",summary:"Error Message",detail:r.payload.transtatus.lstErrorItem[0].Message}))}).catch(r=>{var n;(n=o.current)==null||n.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})}}),L=te({initialValues:_,validationSchema:Ie,onSubmit:(l,{resetForm:d})=>{var s,D;if(!l.AttachmentName||l.AttachmentName==""){(s=o.current)==null||s.show({severity:"error",summary:"Error Message",detail:"Please Upload the Document"});return}if(b.filter(m=>m.DocumentName==l.DocumentName).length>0)(D=o.current)==null||D.show({severity:"error",summary:"Error Message",detail:"Document Name is Already Exists"});else{let m={};m.VehicleDocumentDetailId=0,m.VehicleId=0,m.DocumentName=l.DocumentName,m.DocumentNo=l.DocumentNo,m.AttachmentUrl=l.AttachmentUrl,m.AttachmentName=l.AttachmentName,m.Remarks=l.Remarks,j([...b,m]),p&&(x.length>0?k([...x,p]):k([p])),H()}}}),K=(l,d,a)=>{y.setFieldValue(l,a)},de=(l,d,a)=>{y.setFieldValue(l,a),h(Le({CompanyId:a}))},Z=()=>{y.resetForm(),L.resetForm(),j([]),A("")},me=(l,d,a)=>{y.setFieldValue(l,a);let s=W.find(D=>D.SupplierId==a);y.setFieldValue("SupplierMobileNo",s.SupplierMobileNo),y.setFieldValue("SupplierAddress",s.Address)},ue=(l,d,a)=>{y.setFieldValue(l,a),a==28&&(y.setFieldValue("SupplierId",null),y.setFieldValue("SupplierMobileNo",""),y.setFieldValue("SupplierAddress","")),I(!F)},H=()=>{L.resetForm(),M(null),A("")},he=(l,d)=>{const a=l.name.slice((l.name.lastIndexOf(".")-1>>>0)+2).toLowerCase(),s=l.type.toLowerCase();return d.includes(a)||d.includes(s)},pe=l=>{var a,s,D;const d=["jpeg","jpg","png","pdf","doc","docx","xls","xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"];if(l.files&&!he(l.files[0],d)){(a=o.current)==null||a.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"}),(s=c.current)==null||s.clear();return}if(l.files.length>0){M(l.files[0]),L.setFieldValue("AttachmentName",l.files[0].name);const m=URL.createObjectURL(l.files[0]);L.setFieldValue("AttachmentUrl",m),A(m)}else(D=o.current)==null||D.show({severity:"warn",summary:"Error Message",detail:"Please Upload only Files with Format (Image/ JPEG, JPG, PNG & DOC/ WORD, EXCEL, PDF)"})},fe=()=>{L.setFieldValue("AttachmentName",null),L.setFieldValue("AttachmentUrl",null),A("")},ye=l=>{window.open(l,"_blank")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsxs("div",{className:"grid grid-nogutter",children:[e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Vehicle"})}),e.jsx("div",{className:"md:col-6 text-right",children:e.jsxs("div",{className:"action-btn",children:[e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",type:"submit",disabled:!!(v||P),onClick:()=>y.handleSubmit()}),e.jsx(g,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:!!(v||N==!1),onClick:()=>Z()})]}),e.jsx(g,{label:"",icon:"pi pi-search",title:"Back to Search",className:"p-button p-button-success text-center",onClick:()=>{i.push("/home/vVehicle")}})]})})]})}),C?e.jsx(ge,{}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-container scroll-y",children:[e.jsx(se,{isCreate:N,isView:v,createEditData:E,loading:C,error:V,StatusList:O,HdrTable:t,EmployeeList:ie,CompanyList:J,PlantList:X,formik:y,handleSelect:K,handleCompanySelect:de,OnChangeCompanyList:re,plantList:T,SupplierList:W,VehicleTypeList:oe,handleSupplierSelect:me,handleVehicleSelect:ue,DisableSupplier:F,OnClear:H}),e.jsx(Ee,{isCreate:N,isView:v,createEditData:E,loading:C,error:V,StatusList:O,HdrTable:t,CompanyList:J,PlantList:X,formik:L,handleSelect:K,vehicleDetailList:b,vehicleDetailForm:_,OnClear:H,setVehicleDetailList:j,onUploadDocument:pe,ClearFileUpload:fe,AttachmentUrl:q,handleClick:ye})]})})]})}),e.jsx(je,{ref:o})]})};export{He as default};
