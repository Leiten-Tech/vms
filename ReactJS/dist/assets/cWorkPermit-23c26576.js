import{a as ol,u as rl,r as u,b as tl,c as Ne,p as il,dF as ye,dJ as De,dK as ge,a9 as nl,j as l,B as A,n as y,bM as Ae,A as cl,d9 as ve,d as dl,t as _,dL as ul,dM as pl,dN as ml,dO as xe,az as kl,I as hl}from"./index-25a41ef1.js";import{F as Ce}from"./fileupload.esm-b904f07b.js";import{D as Wl,C as T}from"./column.esm-11a46c7b.js";import{V as fl}from"./VisitorManagement-638cb0f9.js";import"./index.esm-9a713e1a.js";import"./index.esm-21a4a4d3.js";const be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAnRJREFUeJztm71uE0EURs+sIosqBRKRCGnpaJIFIYhTAS9AH8o8AA20qUgegZqOF0AUNCQRUiQLQZAQNSQFjxAFD4V3ibXeWTyeXzv3SNN478zc+TT38+6sDYIwLT1gHzgDdOR2DKyEX2I3e8Rf+Hg7IbEIp1UiDyPPm40IdRKp5j0hsQhtAhzhf6sfGOZdIYAIhWP/oY8kGph22W/gEfANuAN8IPJOSF0CNTeAr9Vn34GbqRJJOW8SEVJ7QBMvnjBPHtAkuifkVALjRCuHXAWASCKk9gCbdjztoubBAw5nGOOej0SapCoBW6zydN0Bc4+rACE8wNUzrMjRA2yJVpbiAYuIeIBLZ8QDskQ8wAbxAJfOiAdkiXiADeIBLp0RD8gS8QAbrrwAynRBb3CEiv4qPBSHasBW2wWzAOVc1PvUqEH7Wq98CYgAnkfbVANU3bjGMpqnwI/OuCG3gJfAuSnmX6yi7zNlrx5gqjP9gOuc8wVY64wrecHox1jmmA22UHz0lduS7UDTMCbeLxQ76hPvdMlz4K0hbuTSQ95QjARoiQlCaA9YQ/MagCXed8T1AdRnzgLnM0E8E7wwl1tKgpTAGD/R7ACgeDzLZm7Wrr7LJnqmF6atBBFgIumRCb7yMviQwudeCroD9H2W+cOTavG3ZxojsAmG/Ra4CDG6X3K5EzwA0Ousxp44tAl2MnFzUvAsdg5eBdAlffT/LUqX9NXg0sn1OqsUbAO7tmO5Io/DsRPJDRGg45q3u60McHp3UCPH4ouICJA6gdTYCFAfVng9k/NMffYf5GAl9R8nbZqfR+8GvUqE+g+UObbTKsdeCAGEReQvM0QsM73oQWMAAAAASUVORK5CYII=",Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAANrSURBVHic7ZvNaxNBGIef2TQtleqhqCB+3MSDgh5MBbU2VVFE8SNaL977B/QmePBk9eS5HhV7sJJeBFHUVK1Fkwpq/cCzxoNHUazW3ddDdyUu2ZBtZnfSZB8YEjI7M+/88s5vJrsEEhLqpRO4AnwBJOZSBNZGP8XaXCb+iVeWOQyLUHYD2R3zuE0jgheEqXHnMCxCNQEeoz/VCwHjriUCESwdncTEV+AA8BbYBjwk5kwwvQQ81gBv3M8+AOtMBWJyXCMimPYAP1o8YTl5gJ/YPaGZlkAlsS2HZhUAYhLBtAeEKcV6J7UcPGB6CW0y2qPA3BIIS6g4l0MGREqjAkThAY16RijaPgPCkHhAK5J4QCON243EA1qRxAMaadxuJB7QijQqwDPa3AOcBtsvKxIPaEXaXgAVVDFYyj0j/kfhUTFdyOT7q1XUyoBWmTzA3qCKtl8CbS9Ah66OlDDwqC//xP95dvbUXiXq6eI11p5HfbdnvLo908dXdqU7Doolo6C2+Jr+QtQYFuPp9Iq397ff+FGtz4bjDqoYLOVC7flBAlT2Vcjkq453eGao93fafg1scKMqY8vRwq7J17riCxpbWwaI4vFgKVfXoBXBf1Y4w/cyE3f3z54aEVG3gF/e5PcVT2xMqdRV4BCwslafS0WbAEtkg2CNAZu6/szfm091g6ixwq68N/lXQG9lg2zpTHbxnZ5TuGkB/rHQ0aMQG6XsmwDuN9/rv07hNPTjx4/pXeCTiAwD2OIcBHBWpN+7dYfiCMBIBvjX8eGZod4FZY9KDVurNFmdu0B0GaAow+JWF3TJkedHVg2WTp9e6LSfi7AZQP10tgKI4kFQu6mdk0t5ZF6VKDPgOkBXdyojPr/ydoF5AIT/vnmRc8ALJanzYA/g+oC3y+jeBfRngKKMYnR1d+oigDhqJGQPw9niyR2FzMRHsdkOagLkm/Y4XSI9Ce6fzV0Q4WjIrrqUZd3JFk8em+rLvwLO6oqxGtqXQPbdUI81/6dPHDXin3zde7iwXinrRbaUu5ZyZNzu6Zib2jrx3as+8PJMv+PoOQdoOwo3O0HeYfocYJxEgBp12vZa04iIlkNTclu8FUkEMB2AacII8MV9DbzF3AR49/7LUXQ+ivknwfWWS1EI0OmK4P2BshnLZ3fynVEIkNCK/AUENKBKJMUwYQAAAABJRU5ErkJggg==",je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAPKSURBVHic7Zs/bBNXHMc/7xwnIgodIhWpUuiGOqQSDHGQChQ7pEGoqCUx7sKerUO7tEiMqIEFhk7pVKmCAYOzIKEgiB0IEbJTCQj0z1zC0KFSK0pDwt2vQ+4ic76z7Nw//7mPdLJzv3vv/d7X733f810MMTGN0gtcBF4AEvJRBvYE38X6XCD8jlcfq0QswpqZyEcht9syIlhJRNXuKhGL4CTAIv4P9aJLu3sIQATNj0pC4k/gGPAU+BC4S8gjIeopYPEu8MQ89yvwXlSJRNluJCJE7QF2fPGEdvIAO6F7QitNgWpCmw6tKgCEJELUHtDMUW60U+3gAUs7KJPyPQuimwLN0lSe7TACAsWrAEF4gFfPaIquHwHNEHtAJxJ7gJfC3UbsAZ1I7AFeCncbsQd0Il4FeECXe4DhsXxbEXtAJ9L1Aii3QKYy9YDwH4UHxVIxVTjiFKg3Ajql8wCH3QJdPwW6XoAePypRoh1aGL2+bP19aOmz3X3JnnHRZAbUB9Z5QX0C6o3CmGfrn67M8hwFEMWirerXiJpF42oy2f/09v6f/rUC6ZXJw0rUfc+5uwUylamG19JiquBYz/Hl3OBGUn8MDFVfN1bJXhDkG3v5t9pUrKHLp8WDc4+DzNGXEWBRldBzhTE9n8rfGluZ/FpEXau+zujXzqtX+hlMYRx4bXX+4/LnexMqcRmYAHaDe2d2gq8CVDEkaLPA+31v1ufXE7veCpaG8y+dhNlG1GzxYMHq/CNgsDqcrpxOb73zvhMP3AQ3ewZqPq30s9zAwshcHrjjVEYp/QqA+ckP1sQxigrD05cgi6AE+ENEpgF0McZrGn1lnAMQpb4ENuxxoz/5i/l2IqD8tvF1Ctjn5vHl3OCm0mfEZlWCfJVeyf5YGrnx21gle7nR+pVwdGG0cA/8WwUCGQEnHp54J1PJZjd79Yci7HO4pFeJfA9bhmgPqv+MYQBRzlMEoDQyt5PH5jX4KkCmMiWZypSsJ3b9DXLdpfMW42Mrk7nScP5lTUTkDICSxFngr+3TisVmlr5GiHQnKKIupZ/lBhxC0+nyqQPFVP530dkPKg/yTxA5BLUMNsqQaYjf2s73KU27mS6fOlkaLTwCvggqAV92goKW2aqs/tLkct0GIhNKS/SJGPO2IhsCPyQMuaoP9KxWT5djP58+YhjGvUZzdNs8+SJAO+AmQNd/G4wFqBPzZZ1tBUTE84YJ4tvinUksQNQJRE0zArwwX11vMbcA1r3/tSAqnyH6J8GNHt8FIUCvKYL1A8pWPJ6bnd++4xwTU5//AaqMwo+MjssvAAAAAElFTkSuQmCC",wl=()=>{const $=ol(),R=rl(),[Pe,X]=u.useState(!1),[Ie,ee]=u.useState([]),[le,ae]=u.useState([]),[se,oe]=u.useState([]),[re,te]=u.useState([]),[j,F]=u.useState([]),[Fe,q]=u.useState(),[x,ie]=u.useState(),[v,E]=u.useState([]),[Y,we]=u.useState(),[w,L]=u.useState([]),[C,b]=u.useState([]),[V,J]=u.useState([]),[B,Q]=u.useState([]),[D,O]=u.useState([]),[H,G]=u.useState([]),[ne,ce]=u.useState(),[K,P]=u.useState(),[g,Ve]=u.useState(),W=u.useRef(),f=u.useRef(),M=u.useRef(),Me=[{Id:1,CountryCode:"+91",CountryName:"India"}],{isCreate:U,isView:p,loading:Ue,error:Nl,tranStatus:yl,createEditData:d,WorkOrganiser:Dl,CompanyDocs:gl,WorkDocs:Al,WorkerStatusList:vl}=tl(e=>e.workPermit),Ee={WorkPermitId:d?d.WorkPermitId:0,WorkPermitCode:d?d.WorkPermitCode:"",WorkPermitDate:d?new Date(d.WorkPermitDate):new Date,CompanyId:d?d.CompanyId:localStorage.CompanyId,PlantId:d?d.PlantId:localStorage.PlantId,GateId:d?d.GateId:localStorage.GateId,ValidFrom:d?d.ValidFrom:"",ValidTo:d?d.ValidTo:null,ContractorName:d?d.ContractorName:"",WorkOrganizer:d?d.WorkOrganizer:"",PoNo:d?d.PoNo:"",StatusRemarks:d?d.StatusRemarks:"",Status:d?d.Status:74,DocStatus:d?d.DocStatus:74,CreatedBy:d?d.CreatedBy:+localStorage.UserId,CreatedOn:d?new Date(d.CreatedOn):new Date,ModifiedBy:d?+localStorage.UserId:null,ModifiedOn:d?new Date:null},z=Ne({initialValues:{Remarks:""},onSubmit:(e,{resetForm:s})=>{}}),a=Ne({initialValues:Ee,validationSchema:fl,onSubmit:(e,{resetForm:s})=>{if(P(!0),Be()){let n={...e};n.ValidFrom=_(e.ContractValidity[0]),n.ValidTo=_(e.ContractValidity[1]),n.WorkPermitDate=_(new Date),delete n.ContractValidity,delete n.WorkerPhoneNo,delete n.CompanyDocType,delete n.CompanyDocNumber,delete n.WorkerName,delete n.CountryCode,delete n.WorkerMailID,delete n.WorkerStatus,delete n.WorkerDocType,delete n.WorkerDocNumber;let k=ul({WorkerPermit:n,WorkerPermitWorkers:C,WorkerPermitCompanyDocs:w},B,H);if(U){var r=R(pl(k));r.then(t=>{var h,N;t.payload.tranStatus.result==!0?(P(!1),Z(),(h=M.current)==null||h.show({severity:"success",summary:"Success Message",detail:t.payload.tranStatus.lstErrorItem[0].Message})):(P(!1),(N=M.current)==null||N.show({severity:"warn",summary:"Warning Message",detail:t.payload.tranStatus.lstErrorItem[0].Message}))}).catch(t=>{P(!1)})}else{var o=R(ml(k));o.then(t=>{var h,N,I;if(t.payload.tranStatus.result==!0)if(x&&Object.keys(x).length>0){(h=M.current)==null||h.show({severity:"success",summary:"Success Message",detail:"Document Status Updated Successfully."}),ue().then(sl=>{pe(sl)}),q(!1),ie({});return}else P(!1),Z(),q(!1),setTimeout(()=>{$.push("/home/vWorkPermit")},800),(N=M.current)==null||N.show({severity:"success",summary:"Success Message",detail:t.payload.tranStatus.lstErrorItem[0].Message});else(I=M.current)==null||I.show({severity:"warn",summary:"Warning Message",detail:t.payload.tranStatus.lstErrorItem[0].Message}),P(!1),q(!1)}).catch(t=>{P(!1)})}}else P(!1)}}),Be=e=>a.values.ContractorName==""||a.values.ContractorName==null?m("Please Enter Contractor Name."):a.values.WorkOrganizer==""||a.values.WorkOrganizer==null?m("Please Select WorkOrganizer."):a.values.ContractValidity&&a.values.ContractValidity==""||a.values.ContractValidity==null?m("Please Select Contract Validity."):a.values.ContractValidity&&a.values.ContractValidity[0]==""||a.values.ContractValidity[0]==null?m("Please Select Contract Validity From."):a.values.ContractValidity&&a.values.ContractValidity[1]==""||a.values.ContractValidity[1]==null?m("Please Select Contract Validity To."):a.values.PoNo==""||a.values.PoNo==null?m("Please Enter PoDoc RefNo."):B&&B.length==0?m("Please Enter Atleast One Company Document"):C&&C.length==0?m("Please Enter Atleast One Worker"):!0,de=e=>{if(e==1&&z.values.Remarks==null&&z.values.Remarks=="")return m("Please Enter Remarks");{let s=[...C],i=s.findIndex(o=>o.WPWorkerDetailId==x.WPWorkerDetailId);if(i!==-1){const o=[...s[i].WpWorkerDocs],n=o.findIndex(c=>c.WPWorkerDocId===x.WPWorkerDocId);n!==-1&&(o[n]={...o[n],Status:e==0?75:76,Remarks:z.values.Remarks},s[i]={...s[i],WpWorkerDocs:o},b(s))}[...s].forEach(o=>{o.WpWorkerDocs.every(n=>n.Status==75)?a.setFieldValue("DocStatus",75):o.WpWorkerDocs.some(n=>n.Status==76)?a.setFieldValue("DocStatus",76):o.WpWorkerDocs.some(n=>n.Status==74)&&a.setFieldValue("DocStatus",74)}),a.handleSubmit()}},Oe=l.jsxs("div",{children:[l.jsx(A,{label:"Approve",icon:"pi pi-check",onClick:()=>de(0),autoFocus:!0}),l.jsx(A,{label:"Reject",icon:"pi pi-times",onClick:()=>de(1),severity:"danger"})]}),Te=l.jsx("div",{children:l.jsx(A,{label:"Cancel",icon:"pi pi-times",onClick:()=>X(!1),severity:"danger"})});u.useEffect(()=>{il()}),u.useEffect(()=>{S("WorkerPhoneNo",{},"+91")},[]);const ue=()=>{const e={WorkPermitId:d.WorkPermitId,PlantId:+localStorage.PlantId,CompanyId:+localStorage.CompanyId};return R(ye(e))};u.useEffect(()=>{if(d!=null)U==!1&&ue().then(s=>{pe(s)});else{const e={WorkPermitId:0,PlantId:+localStorage.PlantId,CompanyId:+localStorage.CompanyId};R(ye(e)).then(i=>{a.setFieldValue("WorkerStatus",1),ae(i.payload.CompanyDocs),oe(i.payload.WorkDocs),ee(i.payload.WorkOrganiser),te(i.payload.WorkerStatusList)})}},[]);const pe=e=>{ae(e.payload.CompanyDocs),oe(e.payload.WorkDocs),ee(e.payload.WorkOrganiser),te(e.payload.WorkerStatusList),L(e.payload.WpCompanyDocDetail),we(e.payload.WorkPermitHeader),a.setFieldValue("ContractValidity",[new Date(e.payload.WorkPermitHeader.ValidFrom),new Date(e.payload.WorkPermitHeader.ValidTo)]),a.setFieldValue("PoNo",e.payload.WorkPermitHeader.PoNo);let s=JSON.parse(JSON.stringify(e.payload.WpWorkerDetail));const i=[...e.payload.WpWorkerDocDetail],r=s.map(async c=>{c.WorkerPhoneNo=c.MobileNo,c.WorkerMailID=c.MailId,c.WorkerStatus=c.Status==1?"Active":"In Active",c.WorkerDocs=[];const k=i.filter(t=>c.WPWorkerDetailId===t.WPWorkerDetailId).map(async t=>{const h={...t};h.FileName=t.DocumentName;const N=await De(t.DocumentFullUrl);return h.file=N,h.FileBlobUrl=ge(N),h.WorkerDocRefNo=t.DocumentNo,h});return c.WorkerDocs=await Promise.all(k),c});Promise.all(r).then(c=>{const k=c.flatMap(N=>N.WorkerDocs.map(I=>I.file)),t=new Map;e.payload.WpWorkerDocDetail.forEach(N=>{const I=N.WPWorkerDetailId;t.has(I)||t.set(I,[]),t.get(I).push(N)});const h=e.payload.WpWorkerDetail.map(N=>({...N,WpWorkerDocs:t.get(N.WPWorkerDetailId)||[]}));b(h),G(k),F(c)}),JSON.parse(JSON.stringify(e.payload.WpCompanyDocDetail));const n=[...e.payload.WpCompanyDocDetail].map(async c=>{const k={...c};k.FileName=c.DocumentName;const t=await De(c.DocumentFullUrl);return k.file=t,k.FileBlobUrl=ge(t),k.CompanyDocRefNo=c.DocumentNo,k});Promise.all(n).then(c=>{let k=c.map(t=>t.file);Q(k),J(c)})},qe=e=>{const s=e.target.value;let i={...me};i.global.value=s,Je(i),Re(s)},[Ge,Re]=u.useState(""),Le=(()=>l.jsx("div",{className:"flex justify-content-start",children:l.jsxs("span",{className:"p-input-icon-left",children:[l.jsx("i",{className:"pi pi-search"}),l.jsx(hl,{value:Ge,onChange:qe,placeholder:"Keyword Search"})]})}))(),[me,Je]=u.useState({global:{value:null,matchMode:nl.CONTAINS}}),ke={icon:"las la-cloud-upload-alt"},Qe=e=>{a.setFieldValue(e.target.name,e.value)},S=(e,s,i)=>{a.setFieldValue(e,i)},he=(e,s)=>(console.log(e),[".csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"].includes(e.type)||!["image/png","image/jpeg","image/jpg","application/pdf"].includes(e.type)?(s==1?W==null||W.current.clear():f==null||f.current.clear(),m("Please Select Valid Files Pdf or Png, Jpeg")):!0),He=e=>{var s;if(console.log(e),e.files[0]){if(he(e.files[0],1)){let r={},o={};r={file:e.files[0]},a.values.CompanyDocType&&(r.CompanyDocType=le.filter(n=>n.MetaSubId==a.values.CompanyDocType)[0].MetaSubDescription),r.CompanyDocRefNo=a.values.CompanyDocNumber,r.FileName=e.files[0].lastModified+"_"+e.files[0].name,r.FileBlobUrl=xe(e.files[0]),o.CompanyId=+localStorage.CompanyId,o.PlantId=+localStorage.PlantId,o.GateId=+localStorage.GateId,o.WPCompanyDocId=0,o.WorkPermitId=0,o.DocumentName=e.files[0].lastModified+"_"+e.files[0].name,o.DocumentNo=a.values.CompanyDocNumber,o.DocumentUrl=e.files[0].lastModified+"_"+e.files[0].name,o.Remarks="",J([...V,r]),r.file.FileName=r.FileName,Q([...B,r.file]),L([...w,o]),a.setFieldValue("CompanyDocType",[]),a.setFieldValue("CompanyDocNumber",""),(s=W==null?void 0:W.current)==null||s.clear()}}else return m("Please Select Valid Files Pdf or Png, Jpeg")},ze=e=>{var s;if(e.files[0]){if(he(e.files[0],0)){let r={},o={};r={file:e.files[0]},a.values.WorkerDocType&&(r.WorkerDocType=se.filter(n=>n.MetaSubId==a.values.WorkerDocType)[0].MetaSubDescription),r.WorkerDocRefNo=a.values.WorkerDocNumber,r.FileName=e.files[0].lastModified+"_"+e.files[0].name,r.FileBlobUrl=xe(e.files[0]),o.CompanyId=+localStorage.CompanyId,o.PlantId=+localStorage.PlantId,o.GateId=+localStorage.GateId,o.WPCompanyDocId=0,o.WPWorkerDetailId=0,o.DocumentName=e.files[0].lastModified+"_"+e.files[0].name,o.DocumentNo=a.values.WorkerDocNumber,o.DocumentUrl=e.files[0].lastModified+"_"+e.files[0].name,o.Remarks="",o.Status=74,O([...D,r]),r.file.FileName=r.FileName,G([...H,r.file]),E([...v,o]),a.setFieldValue("WorkerDocType",[]),a.setFieldValue("WorkerDocNumber",""),(s=f==null?void 0:f.current)==null||s.clear()}}else return m("Please Select Valid Files Pdf or Png, Jpeg")},We=e=>{var s,i,r,o,n;((s=e==null?void 0:e.file)==null?void 0:s.type)=="image/png"||((i=e==null?void 0:e.file)==null?void 0:i.type)=="image/jpeg"||((r=e==null?void 0:e.file)==null?void 0:r.type)=="image/jpg"?(ce((o=e==null?void 0:e.file)!=null&&o.objectURL?(n=e==null?void 0:e.file)==null?void 0:n.objectURL:e!=null&&e.DocumentUrl.startsWith("http://")||e!=null&&e.DocumentUrl.startsWith("https://")?e==null?void 0:e.DocumentUrl:e==null?void 0:e.DocumentFullUrl),X(!0)):(ce(e==null?void 0:e.FileBlobUrl),window.open(e==null?void 0:e.FileBlobUrl))},Xe=(e,s)=>{var c,k;s.stopPropagation();let i=D.filter(t=>t.FileName==e.FileName),r=H.filter(t=>!i.some(h=>h.file.name===t.name));G(r);let o=D.indexOf(i[0]);if(o>=0&&o<D.length){let t=[...D];t.splice(o,1),O(t),a.setFieldValue("WorkerDocType",[]),a.setFieldValue("WorkerDocNumber",""),(c=f==null?void 0:f.current)==null||c.clear()}v.filter(t=>t.FileName==e.FileName);let n=v.indexOf(i[0]);if(n>=0&&n<v.length){let t=[...v];t.splice(n,1),E(t),a.setFieldValue("WorkerDocType",[]),a.setFieldValue("WorkerDocNumber",""),(k=f==null?void 0:f.current)==null||k.clear()}},Ye=(e,s)=>{var c,k;s.stopPropagation();let i=V.filter(t=>t.FileName==e.FileName),r=B.filter(t=>!i.some(h=>h.file.name===t.name));Q(r);let o=V.indexOf(i[0]);if(o>=0&&o<V.length){let t=[...V];t.splice(o,1),J(t),a.setFieldValue("CompanyDocType",[]),a.setFieldValue("CompanyDocNumber",""),(c=W==null?void 0:W.current)==null||c.clear()}w.filter(t=>t.FileName==e.FileName);let n=w.indexOf(i[0]);if(n>=0&&n<w.length){let t=[...w];t.splice(n,1),L(t),a.setFieldValue("CompanyDocType",[]),a.setFieldValue("CompanyDocNumber",""),(k=W==null?void 0:W.current)==null||k.clear()}},m=e=>{var s;(s=M.current)==null||s.show({severity:"warn",summary:"Warning Message",detail:e})},Ke=()=>{const e=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;if(a.values.WorkerName==""||a.values.WorkerName==null)return m("Please Enter Worker Name.");if(a.values.CountryCode==""||a.values.CountryCode==null)return m("Please Enter Phone No.");if(a.values.CountryCode.length!=10)return m("Please Enter Valid Phone No.");if(a.values.WorkerMailID!=""&&a.values.WorkerMailID!=null&&!e.test(a.values.WorkerMailID))return m("Please Enter Valid Mail ID.");let s=!1;if(j.forEach(r=>{a.values.WorkerMailID!=""&&a.values.WorkerMailID==r.WorkerMailID&&(s=!0)}),s)return m("Mail ID Already Exists for a Worker.");let i=!1;return j.forEach(r=>{a.values.CountryCode!=""&&a.values.CountryCode==r.WorkerPhoneNo&&(i=!0)}),i?m("Mobile No Already Exists for a Worker."):a.values.WorkerStatus==""||a.values.WorkerStatus==null?m("Please Select Worker Status."):D&&D.length==0?m("Please Upload Atleast One Worker Document"):!0},Ze=()=>{a.setFieldValue("WorkerName",""),a.setFieldValue("CountryCode",""),a.setFieldValue("WorkerMailID",""),a.setFieldValue("WorkerStatus",1),E([]),b([]),O([]),G([])},_e=()=>{if(Ke()){if(U)F([...j,{WorkerName:a.values.WorkerName,WorkerPhoneNo:a.values.CountryCode,WorkerMailID:a.values.WorkerMailID,WorkerStatus:a.values.WorkerStatus==1?"Active":"In Active",WorkerDocs:D}]),b([...C,{WpWorkerDetailId:0,WorkPermitId:0,WorkerName:a.values.WorkerName,MobileNo:a.values.CountryCode,MailId:a.values.WorkerMailID,Status:a.values.WorkerStatus,WpWorkerDocs:v}]);else{let s=[];v&&v.length>0?D.forEach(r=>{const o=v.find(n=>n.DocumentName===r.FileName||n.DocumentName===r.DocumentName);o?s.push({...r,...o}):s.push({...r})}):s=[...D];let i=[...s];if(g){delete g.WorkerDocs,g.WorkerName=a.values.WorkerName,g.WorkerPhoneNo=a.values.CountryCode,g.WorkerMailID=a.values.WorkerMailID,g.WorkerStatus=a.values.WorkerStatus==1?"Active":"In Active",g.WorkerDocs=[],g.WorkerDocs=i,F([...j,{...g}]);let r=[...C];const o=r.findIndex(c=>c.WPWorkerDetailId===g.WPWorkerDetailId);let n=[...i];if(n.forEach(c=>{delete c.file}),o!==-1){const c=r[o];c.WorkerName=a.values.WorkerName,c.MobileNo=a.values.CountryCode,c.MailId=a.values.WorkerMailID,c.Status=a.values.WorkerStatus,c.WpWorkerDocs=[],c.WpWorkerDocs=n,b(r)}else{let c=r;g.WpWorkerDocs=g.WorkerDocs,c.push(g),b(c)}}else F([...j,{WorkerName:a.values.WorkerName,WorkerPhoneNo:a.values.CountryCode,WorkerMailID:a.values.WorkerMailID,WorkerStatus:a.values.WorkerStatus==1?"Active":"In Active",WorkerDocs:D}]),b([...C,{WpWorkerDetailId:0,WorkPermitId:0,WorkerName:a.values.WorkerName,MobileNo:a.values.CountryCode,MailId:a.values.WorkerMailID,Status:a.values.WorkerStatus,WpWorkerDocs:v}])}a.setFieldValue("WorkerName",""),a.setFieldValue("CountryCode",""),a.setFieldValue("WorkerMailID",""),a.setFieldValue("WorkerStatus",1),O([]),E([])}},fe=(e,s)=>{q(!0),ie(s)},$e=e=>l.jsx("div",{children:l.jsx("div",{children:e.WorkerDocs&&e.WorkerDocs.map(s=>l.jsxs("div",{className:"align-items-center border-1 border-black-alpha-20 border-round flex justify-content-between mb-3 p-2",children:[l.jsxs("div",{className:"flex flex-column",children:[l.jsx("a",{className:"text-blue-600 underline",target:"_blank",href:s.FileBlobUrl,children:s.FileName}),l.jsxs("div",{className:"mt-1",children:[l.jsx("span",{className:"font-bold",children:"Status:"})," ",(s==null?void 0:s.Status)==74||(s==null?void 0:s.Status)==null?"In Progress":s.Status==76?"Rejected":"Approved"]}),l.jsxs("div",{className:"mt-2",children:[l.jsx("span",{className:"font-bold",children:"Remarks:"})," ",s.Remarks||"-"]})]}),(Y==null?void 0:Y.PrimaryUserId)==+localStorage.UserId||(e==null?void 0:e.Status)==2?l.jsxs("div",{className:"flex",children:[l.jsx(A,{label:"",severity:"info",icon:"pi pi-check",title:"Approval",className:"mr-2 p-1",disabled:s.Status==75,onClick:()=>fe(e,s)}),l.jsx(A,{label:"",severity:"danger",icon:"pi pi-times-circle",title:"Reject",className:"mr-2 p-1",disabled:s.Status==75,onClick:()=>fe(e,s)})]}):null]}))})}),el=(e,s)=>{console.log(e),Ve(e),a.setFieldValue("WorkerName",e.WorkerName),a.setFieldValue("CountryCode",e.WorkerPhoneNo),a.setFieldValue("WorkerMailID",e.WorkerMailID),a.setFieldValue("WorkerStatus",e.WorkerStatus=="Active"?1:2),O(e.WorkerDocs),e.WorkerDocs.map(c=>c.file);let i=[...j];i.splice(s.rowIndex,1),F(i);let r=[...C],o=r.splice(s.rowIndex,1)[0];console.log(o),r.splice(s.rowIndex,1),b(r);let n=[o];console.log([o]),E(n.map(c=>c.WpWorkerDocs)[0])};u.useEffect(()=>{console.log(v)});const ll=(e,s)=>{let i=[...j];i.splice(s.rowIndex,1),F(i);let r=[...C];r.splice(s.rowIndex,1),b(r)},al=(e,s)=>l.jsx("div",{className:"action-btn",children:l.jsxs(kl.Fragment,{children:[l.jsx(A,{label:"",title:"Edit",icon:"pi pi-pencil",className:"mr-2 p-1 p-button-success",disabled:p||(e==null?void 0:e.Status)==2,onClick:()=>el(e,s)}),l.jsx(A,{label:"",severity:"danger",icon:"pi pi-trash",title:"Delete",className:"mr-2 p-1",disabled:p||(e==null?void 0:e.Status)==2,onClick:()=>ll(e,s)})]})}),Z=()=>{a.resetForm(),E([]),b([]),O([]),G([]),L([]),J([]),Q([]),F([]),S("WorkerPhoneNo",{},"+91"),S("WorkerStatus",{},1)};return u.useEffect(()=>{console.log(B),console.log(H),console.log(C),console.log(w)}),l.jsxs("div",{className:"page-container",children:[l.jsxs("div",{className:"inner-page-container",children:[l.jsx("div",{className:"page-title",children:l.jsxs("div",{className:"grid grid-nogutter",children:[l.jsx("div",{className:"md:col-6",children:l.jsx("h1",{children:"Work Permit"})}),l.jsx("div",{className:"md:col-6 text-right",children:l.jsxs("div",{className:"action-btn",children:[l.jsx(A,{label:"",title:"Save",icon:"pi pi-save",className:"text-center",disabled:p||K,onClick:a.handleSubmit}),l.jsx(A,{label:"",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",disabled:p||!U,onClick:()=>Z()}),l.jsx(A,{label:"",icon:"pi pi-search",title:"Search",className:"p-button p-button-success text-center",onClick:()=>{$.push("/home/vWorkPermit")}})]})})]})}),l.jsx("div",{className:"appointment-container scroll-y",children:Ue?l.jsx(cl,{}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"grid",children:[l.jsx("div",{className:"md:col-6 appointment-left",children:l.jsxs("div",{className:"white",children:[l.jsx("div",{className:"widget-hdr",children:l.jsx("div",{className:"sub-title",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"md:col-6",children:l.jsx("h2",{children:"Company Information"})})})})}),l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"normal-table",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"col-12 md:col-12",children:l.jsxs("div",{className:"grid",children:[l.jsx(y,{type:"text",name:"ContractorName",label:"Contractor Name ",options:"",show:!0,required:!0,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-6",formik:a}),l.jsx(y,{type:"select",name:"WorkOrganizer",label:"Work Organizer ",options:Ie,show:!0,required:!0,disable:p,optionLabel:"UserName",optionValue:"UserId",handleSelect:S,fldStyle:"col-12 md:col-6",formik:a}),l.jsx(y,{type:"Calendar",name:"ContractValidity",label:"Contract Validity ",options:"",show:!0,required:!1,disable:p,optionLabel:"",optionValue:"",handleChange:Qe,fldStyle:"col-12 md:col-6",formik:a,minDate:new Date,selectionMode:"range"}),l.jsx(y,{type:"text",name:"PoNo",label:"PO No / Doc Ref No ",options:"",show:!0,required:!0,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-6",formik:a}),l.jsx(y,{type:"select",name:"Status",label:"Status ",options:re,show:!(U||p),required:!1,disable:U||p,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:S,fldStyle:"col-12 md:col-6",formik:a})]})})})})})]})}),l.jsx("div",{className:"md:col-6 appointment-right",children:l.jsxs("div",{className:"white",children:[l.jsx("div",{className:"widget-hdr",children:l.jsx("div",{className:"sub-title",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"md:col-6",children:l.jsx("h2",{children:"Company Documents"})})})})}),l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"normal-table",children:l.jsxs("div",{className:"grid",children:[l.jsx("div",{className:"col-12 md:col-4",children:l.jsxs("div",{className:"grid",children:[l.jsx(y,{type:"select",name:"CompanyDocType",label:"Choose Doc Type ",options:le,show:!0,required:!0,disable:p,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:S,fldStyle:"col-12",formik:a}),l.jsx(y,{type:"text",name:"CompanyDocNumber",label:"Doc Number ",options:"",show:!0,required:!0,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12",formik:a})]})}),l.jsx("div",{className:"col-12 md:col-3",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"col-12",children:l.jsx(Ce,{mode:"basic",name:"CompanyFileUpload",className:"docs-upload",maxFileSize:1e6,chooseOptions:ke,chooseLabel:"Upload File",customUpload:!0,onSelect:e=>He(e),ref:W,disabled:p||a.values.CompanyDocType==null||a.values.CompanyDocType==""||a.values.CompanyDocNumber==null||a.values.CompanyDocNumber==""})})})}),l.jsxs("div",{className:"col-12 md:col-5",children:[l.jsx(Ae,{target:".docs-preview-container.white"}),l.jsx("div",{className:"grid",children:V&&V.map(e=>{var s,i,r;return l.jsx("div",{className:"col-4 md:col-4 text-center",children:l.jsxs("div",{className:"docs-preview-container white m-auto",onClick:()=>We(e),"data-pr-tooltip":e.CompanyDocType,"data-pr-position":"top",children:[l.jsx("img",{src:e&&e.hasOwnProperty("file")&&((s=e==null?void 0:e.file)==null?void 0:s.type)=="image/png"?je:e&&e.hasOwnProperty("file")&&((i=e==null?void 0:e.file)==null?void 0:i.type)=="image/jpeg"||e&&e.hasOwnProperty("file")&&((r=e==null?void 0:e.file)==null?void 0:r.type)=="image/jpg"?Se:be,alt:"logo"}),l.jsx("a",{className:"img-preview-close",title:"Delete","aria-disabled":p,onClick:o=>Ye(e,o),children:l.jsx("i",{className:"las la-times-circle"})})]})})})})]})]})})})]})})]}),l.jsxs("div",{className:"grid",children:[l.jsx("div",{className:"md:col-6 appointment-left",children:l.jsxs("div",{className:"white",children:[l.jsx("div",{className:"widget-hdr",children:l.jsx("div",{className:"sub-title",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"md:col-6",children:l.jsx("h2",{children:"Worker Information"})})})})}),l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"normal-table",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"col-12 md:col-12",children:l.jsxs("div",{className:"grid",children:[l.jsx(y,{type:"text",name:"WorkerName",label:"Worker Name ",options:"",show:!0,required:!0,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-6",formik:a}),l.jsx(y,{type:"text_title",name:"WorkerPhoneNo",label:"Phone No ",options:Me,show:!0,required:!0,disable:p,optionLabel:"CountryCode",optionValue:"CountryCode",handleSelect:S,optionDisable:!0,fldStyle:"col-12 md:col-6",formik:a,keyfilter:"int",maxlength:10,minLength:10,titleInputName:"CountryCode"}),l.jsx(y,{type:"text",name:"WorkerMailID",label:"Worker Mail ID ",options:"",show:!0,required:!1,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12 md:col-6",formik:a}),l.jsx(y,{type:"select",name:"WorkerStatus",label:"Worker Status ",options:re,show:!0,required:!1,disable:U||p,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:S,fldStyle:"col-12 md:col-6",formik:a})]})})})})})]})}),l.jsx("div",{className:"md:col-6 appointment-right",children:l.jsxs("div",{className:"white",children:[l.jsx("div",{className:"widget-hdr",children:l.jsx("div",{className:"sub-title",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"md:col-6",children:l.jsx("h2",{children:"Worker Documents"})})})})}),l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"normal-table",children:l.jsxs("div",{className:"grid",children:[l.jsx("div",{className:"col-12 md:col-4",children:l.jsxs("div",{className:"grid",children:[l.jsx(y,{type:"select",name:"WorkerDocType",label:"Choose Doc Type ",options:se,show:!0,required:!0,disable:p,optionLabel:"MetaSubDescription",optionValue:"MetaSubId",handleSelect:S,fldStyle:"col-12",formik:a}),l.jsx(y,{type:"text",name:"WorkerDocNumber",label:"Doc Number ",options:"",show:!0,required:!0,disable:p,optionLabel:"",optionValue:"",handleSelect:"",fldStyle:"col-12",formik:a})]})}),l.jsx("div",{className:"col-12 md:col-3",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"col-12",children:l.jsx(Ce,{mode:"basic",name:"WorkerFileUpload",className:"docs-upload",chooseOptions:ke,auto:!0,maxFileSize:1e6,chooseLabel:"Upload File",customUpload:!0,onSelect:e=>ze(e),ref:f,disabled:p||a.values.WorkerDocType==null||a.values.WorkerDocType==""||a.values.WorkerDocNumber==null||a.values.WorkerDocNumber==""})})})}),l.jsxs("div",{className:"col-12 md:col-5",children:[l.jsx(Ae,{target:".docs-preview-container.white"}),l.jsx("div",{className:"grid",children:D&&D.map(e=>{var s,i,r;return l.jsx("div",{className:"col-4 md:col-4 text-center",children:l.jsxs("div",{className:"docs-preview-container white m-auto",onClick:()=>We(e),"data-pr-tooltip":e.CompanyDocType,"data-pr-position":"top",children:[l.jsx("img",{src:e&&e.hasOwnProperty("file")&&((s=e==null?void 0:e.file)==null?void 0:s.type)=="image/png"?je:e&&e.hasOwnProperty("file")&&((i=e==null?void 0:e.file)==null?void 0:i.type)=="image/jpeg"||e&&e.hasOwnProperty("file")&&((r=e==null?void 0:e.file)==null?void 0:r.type)=="image/jpg"?Se:be,alt:"logo"}),l.jsx("a",{className:"img-preview-close",title:"Delete","aria-disabled":p,onClick:o=>Xe(e,o),children:l.jsx("i",{className:"las la-times-circle"})})]})})})})]})]})})})]})})]}),l.jsxs("div",{className:"text-center mb-2",children:[l.jsx(A,{label:"Add",title:"Save",icon:"pi pi-save",className:"text-center",onClick:()=>_e(),disabled:K||p}),l.jsx(A,{label:"Cancel",severity:"danger",icon:"pi pi-trash",title:"Clear",className:"text-center",onClick:()=>Ze(),disabled:K||p})]}),l.jsxs("div",{className:"white",children:[l.jsx("div",{className:"widget-hdr",children:l.jsx("div",{className:"sub-title",children:l.jsx("div",{className:"grid",children:l.jsx("div",{className:"md:col-6",children:l.jsx("h2",{children:"Workers List"})})})})}),l.jsx("div",{className:"widget-body",children:l.jsx("div",{className:"card",children:l.jsxs(Wl,{value:j,showGridlines:!0,paginator:!0,filters:me,filterDisplay:"menu",globalFilterFields:["WorkerName","WorkerPhoneNo","WorkerMailID","WorkerStatus"],header:Le,emptyMessage:"No Data found.",rows:50,rowsPerPageOptions:[5,10,25,50,100],tableStyle:{minWidth:"50rem"},children:[l.jsx(T,{field:"Action",header:"Action",style:{textAlign:"center"},body:al,headerClassName:"text-center"}),l.jsx(T,{sortable:!0,field:"WorkerName",header:"Visitor Name"}),l.jsx(T,{sortable:!0,field:"WorkerMailID",header:"Worker Mail ID"}),l.jsx(T,{sortable:!0,field:"WorkerPhoneNo",header:"Phone No"}),l.jsx(T,{sortable:!0,field:"WorkerDocs",header:"Worker Docs",body:$e}),l.jsx(T,{sortable:!0,field:"WorkerStatus",header:"Worker Status"})]})})})]})]})})]}),l.jsx(ve,{header:"Approve "+(x==null?void 0:x.DocumentName)+" ( "+(x==null?void 0:x.DocumentNo)+" ) ?",visible:Fe,position:"bottom-right",style:{width:"50vw"},onHide:()=>q(!1),footer:Oe,draggable:!1,resizable:!1,children:l.jsx(y,{type:"textarea",name:"Remarks",label:"Remarks",options:"",show:!0,required:!1,disable:!1,optionLabel:"",optionValue:"",handleSelect:"",maxlength:"500",formik:z,style:{maxHeight:"100px",overflowY:"auto"}})}),l.jsx(ve,{header:"Preview Document",visible:Pe,style:{width:"95vw"},onHide:()=>X(!1),footer:Te,children:l.jsx("div",{style:{textAlign:"center"},children:l.jsx("img",{style:{width:"50%",height:"100%",objectFit:"contain"},src:ne,alt:ne})})}),l.jsx(dl,{toast:M})]})};export{wl as default};
