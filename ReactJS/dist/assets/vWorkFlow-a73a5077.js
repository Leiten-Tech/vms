import{a as se,r as o,u as re,b as le,p as oe,d8 as F,c as ie,a9 as ne,j as e,A as ce,d as de,d9 as W,n as ue,B as S,da as pe,I as me,db as he}from"./index-25a41ef1.js";import{D as O,C as m}from"./column.esm-11a46c7b.js";import{e as E}from"./ExportService-4b3a6c99.js";import"./index.esm-9a713e1a.js";import"./jspdf.es.min-40ee8370.js";const ge=c=>{const{handleClosePop:h,visible:N,viewList:v,data:x}=c,b=i=>e.jsx("div",{children:e.jsx("img",{src:i.Visitor_Image})},i.StatusName),f=(i,g)=>{if(g.avatar)return b(i);if(g.action,!g.badge||!g.action)return e.jsx(e.Fragment,{children:i[g.name]})};return e.jsx(e.Fragment,{children:e.jsx(W,{visible:N,onHide:()=>h(),className:"preview-container",children:e.jsx(O,{value:x,showGridlines:!0,emptyMessage:"No Data Found",style:{minWidth:"50rem"},dataKey:"id",paginator:!0,rows:25,rowsPerPageOptions:[5,10,25,50,100],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Entries",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",children:v.length>0&&v.map(i=>e.jsx(m,{field:i.name,header:i.title,sortable:i.sort,className:"wrap-cell",style:i.colStyle,body:g=>f(g,i)},i.name))})})})},ve=c=>{const{setWorkVisible:h,WorkVisible:N,formik:v,OnApprove:x,OnReject:b,rowData:f}=c;return o.useEffect(()=>{v.setFieldValue("Remarks","")},[]),e.jsx(W,{header:"Approval",visible:N,style:{width:"60vw",maxHeight:"80vh",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},onHide:()=>h(!1),children:e.jsx("div",{style:{maxHeight:"200px"},children:e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsxs("div",{className:"card",children:[e.jsx(ue,{type:"textarea",name:"Remarks",label:"Remarks",options:"",show:!0,required:!1,disable:!1,optionLabel:"",optionValue:"",handleSelect:"",maxlength:"500",formik:v,style:{maxHeight:"100px",overflowY:"auto"}}),e.jsxs("div",{className:"text-center",children:[e.jsx(S,{label:"Approve",severity:"success",title:"Approve",icon:"las la-check",className:"mr-2 p-1",onClick:()=>x(f)}),e.jsx(S,{label:"Reject",severity:"danger",title:"Reject",icon:"las la-check",className:"mr-2 p-1",onClick:()=>b(f)})]})]})})})})})})},Fe=()=>{se();const c=o.useRef(null);o.useRef();const h=re(),[N,v]=o.useState([]);o.useState([]);const[x,b]=o.useState([]),[f,i]=o.useState(!1),[g,L]=o.useState([]),[V,T]=o.useState("");o.useState();const[M,q]=o.useState([]),[B,U]=o.useState([]),{isCreate:xe,isView:fe,SearchData:ye,loading:H,error:je,tranStatus:Se,WorkFlowList:Ne}=le(t=>t.workflow),[G,z]=o.useState(),[_,P]=o.useState(!1),J=t=>{let l={ApprovalRequest:{companyid:+localStorage.CompanyId,plantid:+localStorage.PlantId,requesterid:t.initiatedBy,documentno:t.DocumentNo,documentid:t.DocumentId,documentdetailid:null,remarks1:t.Remarks1,remarks2:t.Remarks2,status:75,approverid:+localStorage.UserId,levelid:t.LevelId,alternateuser:null,parentid:null,userid:+localStorage.UserId,requestfromdate:null,requesttodate:null,Isviewed:1}};A(l)},K=t=>{let l={ApprovalRequest:{companyid:+localStorage.CompanyId,plantid:+localStorage.PlantId,requesterid:t.initiatedBy,documentno:t.DocumentNo,documentid:t.DocumentId,documentdetailid:null,remarks1:t.Remarks1,remarks2:t.Remarks2,status:76,approverid:+localStorage.UserId,levelid:t.LevelId,alternateuser:null,parentid:null,userid:+localStorage.UserId,requestfromdate:null,requesttodate:null,Isviewed:1}};A(l)},A=t=>{var l=h(pe(t));l.then(r=>{var a,s;r.payload.Result.tranStatus.result?((a=c.current)==null||a.show({severity:"success",summary:"Success Message",detail:r.payload.Result.tranStatus.lstErrorItem[0].Message}),P(!1),C()):(s=c.current)==null||s.show({severity:"error",summary:"Error Message",detail:r.payload.Result.tranStatus.lstErrorItem[0].Message})}).catch(r=>{var a;(a=c.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})},X=t=>{const l={VisitorEntryCode:t.DocumentNo};var r=h(he(l));r.then(a=>{if(a.payload.tranStatus.result){console.log(a.payload.ApprovalViewList);const s=[],u=[];a.payload.ApprovalViewList.forEach((n,y)=>{Object.keys(n).forEach(d=>{s.includes(d)||s.push(d)}),s.forEach((d,p)=>{u[p]||(u[p]=[]),u[p].push(n[d])})}),i(!0);const I=s.map(n=>{const y="",d="",p=y.split(" ").concat([n]),j=d.split(" ").concat([n]);return{title:p.join(" ").replaceAll("_"," "),name:j.join(""),sort:!0,avatar:n=="Visitor_Image",badge:!1,colStyle:{minWidth:"10rem"}}});q(I),U(a.payload.ApprovalViewList),i(!0)}}).catch(a=>{var s;(s=c.current)==null||s.show({severity:"error",summary:"Error Message",detail:JSON.stringify(a)})})},Y=(t,l,r)=>e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"",title:"Approved",icon:"las la-check",className:"mr-2 p-1",disabled:t.Status==75||t.Status==76,onClick:()=>{r(t),l(!0)}}),e.jsx(S,{label:"",title:"View",icon:"las la-eye",className:"mr-2 p-1",onClick:()=>X(t)})]});o.useEffect(()=>{C()},[]),o.useEffect(()=>{oe()});const C=()=>{const t={WorkFlowId:0,Taskname:"SearchInitialize",PlantId:+localStorage.PlantId,UserId:+localStorage.UserId,Status:97};var l=h(F(t));l.then(r=>{var a;if(r.payload.tranStatus.result){v(r.payload.WorkFlowList),L(r.payload.WorkFlowCountList);let s=r.payload.WorkFlowCountList,u=[];for(const n in s[0])if(s[0].hasOwnProperty(n)){const y=s[0][n];let d="",p="",j="",k="",w=0;switch(n){case"approved":w=75,d="Approved",j="las la-check-circle",k="color03",p="No. Of Approved";break;case"pending":w=74,d="Pending",j="las la-exclamation-triangle",k="color02",p="No. Of Pending";break;case"rejected":w=76,d="Rejected",j="las la-times-circle",k="color05",p="No. Of Rejected";break}u.push({count:y,stsId:w,text:d,icon:j,iconCol:k,description:p})}const I=u.reduce((n,y)=>n+y.count,0);u.push({count:I,stsId:97,text:"Overall",icon:"las la-plus-circle",iconCol:"color01",description:"OverAll"}),b(u)}else(a=c.current)==null||a.show({severity:"error",summary:"Error Message",detail:r.payload.tranStatus.lstErrorItem[0].Message})}).catch(r=>{var a;(a=c.current)==null||a.show({severity:"error",summary:"Error Message",detail:JSON.stringify(r)})})},$=ie({initialValues:{Remarks:""},onSubmit:(t,{resetForm:l})=>{}}),[R,Q]=o.useState({global:{value:null,matchMode:ne.CONTAINS}}),D=t=>{const l={WorkFlowId:0,Taskname:"SearchInitialize",PlantId:+localStorage.PlantId,UserId:+localStorage.UserId,Status:97};h(F(l)).then(a=>{Z(a.payload.WorkFlowList).then(s=>{t==="pdf"?E.Export("WorkFlow",s,"pdf"):t==="excel"&&E.Export("WorkFlow",s,"excel")}).catch(s=>{console.error(s.message)})})},Z=t=>new Promise((l,r)=>{let a=[];t.length>0?(t.forEach(s=>{let u={"Plant Name":s.PlantName,"Document Type":s.DocumentType,"Document No":s.DocumentNo,Stages:s.Stages,"Requested Date":s.CreatedOn,"Approver Name":s.ApproverName,"Initiated By":s.initiatedByName,"Document Status":s.StatusName};a.push(u)}),l(a)):r(new Error("No data available for export."))}),ee=()=>{const t=l=>{const r=l.target.value;let a={...R};a.global.value=r,Q(a),T(r)};return e.jsxs("div",{className:"flex justify-content-between",children:[e.jsxs("span",{className:"p-input-icon-left",children:[e.jsx("i",{className:"pi pi-search"}),e.jsx(me,{value:V,onChange:t,placeholder:"Search"})]}),e.jsx("div",{className:"flex align-items-center justify-content-end gap-2",children:e.jsxs("div",{className:"action-btn",children:[e.jsx(S,{type:"button",title:"Export Excel",icon:"pi pi-file-excel",severity:"success",onClick:()=>D("excel"),"data-pr-tooltip":"XLS"}),e.jsx(S,{type:"button",title:"Export PDF",icon:"pi pi-file-pdf",severity:"warning",onClick:()=>D("pdf"),"data-pr-tooltip":"PDF"})]})})]})},te=()=>{i(!1)},ae=t=>{const l={WorkFlowId:0,Taskname:"SearchInitialize",PlantId:localStorage.PlantId,UserId:localStorage.UserId,Status:t};h(F(l)).then(a=>{a.payload.tranStatus.result&&(v(a.payload.WorkFlowList),L(a.payload.WorkFlowCountList))}).catch(a=>{})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"inner-page-container",children:[e.jsx("div",{className:"page-title",children:e.jsx("div",{className:"grid grid-nogutter",children:e.jsx("div",{className:"md:col-6",children:e.jsx("h1",{children:"Approval Workflow"})})})}),H?e.jsx(ce,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-container scroll-y",children:[e.jsx("div",{className:"grid",children:x&&x.map(t=>e.jsx("div",{className:"col-3",onClick:()=>ae(t.stsId),children:e.jsx("div",{className:"white",children:e.jsxs("div",{className:"widget-body flex",children:[e.jsx("div",{className:`${t.iconCol} dashboard-icon`,children:e.jsx("i",{className:t.icon})}),e.jsxs("div",{className:"dashboard-count-label",children:[e.jsx("div",{className:"dashboard-count",children:g.map((l,r)=>e.jsx("div",{style:{fontSize:"36px"},children:t.count},r))}),e.jsx("div",{className:"dashboard-label",children:t.description})]})]})})}))}),e.jsx("div",{className:"white",children:e.jsx("div",{className:"widget-body",children:e.jsx("div",{className:"normal-table",children:e.jsx("div",{className:"card",children:e.jsxs(O,{value:N,showGridlines:!0,paginator:!0,filterDisplay:"menu",emptyMessage:"No Data found.",editMode:"cell",rows:10,rowsPerPageOptions:[10,50,100,500,1e3],tableStyle:{minWidth:"50rem"},header:ee,dataKey:"id",filters:R,currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Entries",paginatorTemplate:"CurrentPageReport FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown",globalFilterFields:["PlantName","ApproverName","DocumentType","DocumentNo","Stages","CreatedOn","ApproverName","initiatedByName","StatusName"],children:[e.jsx(m,{header:"Action",body:t=>Y(t,P,z),style:{textAlign:"center"}}),e.jsx(m,{sortable:!0,field:"PlantName",header:"Plant Name"}),e.jsx(m,{sortable:!0,field:"DocumentType",header:"Document Type"}),e.jsx(m,{sortable:!0,field:"DocumentNo",header:"Document No"}),e.jsx(m,{sortable:!0,field:"Stages",header:"Stages"}),e.jsx(m,{sortable:!0,field:"CreatedOn",header:"Requested Date"}),e.jsx(m,{sortable:!0,field:"ApproverName",header:"Approver Name"}),e.jsx(m,{sortable:!0,field:"initiatedByName",header:"Initiated By"}),e.jsx(m,{style:{textAlign:"center"},sortable:!0,field:"StatusName",header:"Document Status"})]})})})})})]}),e.jsx(ve,{rowData:G,OnApprove:J,OnReject:K,WorkVisible:_,setWorkVisible:P,formik:$}),e.jsx(ge,{handleClosePop:te,visible:f,viewList:M,data:B})]})]})}),e.jsx(de,{toast:c})]})};export{Fe as default};
